<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Trace of Front-end]]></title><description><![CDATA[留下自己前端历程的足迹]]></description><link>http://wuhub.top</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 14 Nov 2020 04:11:36 GMT</lastBuildDate><item><title><![CDATA[起底一次vue组件渲染失败]]></title><description><![CDATA[背景 大家在写 vue 组件的过程中，有没有遇到过这种状况：相似的两个组件开发，有个组件数据操作变更的时候页面能够及时响应变更，另一个却不行 最近在做重构任务的过程中，我就遇到了这种问题，如下图，一个 vue 组件:   预期的效果是，点击按钮，图片变成加载状态也就是转菊花^…]]></description><link>http://wuhub.top/then-principles-of-rendering/</link><guid isPermaLink="false">http://wuhub.top/then-principles-of-rendering/</guid><pubDate>Fri, 13 Nov 2020 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;背景&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;大家在写 vue 组件的过程中，有没有遇到过这种状况：相似的两个组件开发，有个组件数据操作变更的时候页面能够及时响应变更，另一个却不行&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;最近在做重构任务的过程中，我就遇到了这种问题，如下图，一个 vue 组件:&lt;/p&gt;
&lt;p&gt;
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b94c16e95a70c9db14e938cdee93c991/e9c61/img13.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAsSAAALEgHS3X78AAAEjklEQVRIx41WSW8cRRRuSJCCMBLLCSVBggMXJMiB5S/khswBBUugnDjwJ7A4ILAA5YSQuKLEcSwsQS45wIFEEYsVC+MszIxn6Z6Z3veluqtr4evpsT22Z8ZpPZWqu+vV9973vnrdyun3Pz/76Q8LS18vLK0899E3z3/87YuXrzxz6asn3/vsqcXl04vLGDF/+oMvXrh8ZeHDlZc++e7ZpZWFS1+eWlxWlOvy1V/khVvyzLpUVuUT16vx1Jp851d58Y589zd58bY885NUrknl6mj8cTTC1qTyympxYSN/62f62gY/v0bPrRaw89fyN9aztzei128kb64nL6/mZ68W546Zct9jDwben9sPN+83zChLmIyoCKnwC+kWEqNXVE+mmtIIWEsd3Nv8e2trK8tSeegScu6liMNrjy8Xs02hZWlYVpJltVsUx6ZlOZ5nmGZ/MEwJkfOdXd8vKK1x0ixzXC9KEtOydcPM82Kec8mYH4Qkz+UYOYEzMG3XDePE9XzEImciM4YVGRk7h2Houa5p6Kaue66DFLCdnI3MvSDIKa1zzriwC6ZltJ+V/wZlycVJOXt+XhTjsEvuULEbkUaQtqOCcjGPbca5H4ZIG1swwYMgUHs9kmV1lepF2KG2/fmBs+sHnh+gPIwzMN9s7cZJMl8eE2yH4X7YIHdo2YbrdbSBOjRMx3Vctz8cqv0+imeYFgqRpKncy5mZtp2hnkUuQfPOP4/u/N7d/Kv1x93W3dta4z8opttTdztd3bS0waCrqlGSHDj7fhAQ4mzfC9tNAXmTVKaxzDMZerLfmSrycdjQlm4YdhBacHYcvIBg4jStuKEF63f5BGGTbFXOo31GxRz0JKkUPgyijuUGlEk4a915paoQcElZ9nYFScFbJyk0UolElpSp7ROcx8iWLrotMVRlZT2ha7zT5EO1WiemS0VBDkVZQmdIvsxSmiRllvGccEJETma5jZ1JXnR6qKjR0/puEOqWHe+V8UQbIVNaI+8LUDym8z4yBLB/qo80sZORaXX+BKSOCTRbGec4sJjMdIaqIV2IdqDraAxoIAgE+aMHobdBz1p/MJdtADNWp1ojV0riosaHCFImmJgSf4Ws9ge252EdXiOE7Z2ddrfbVbWdB48azWZUsu9bREurt3yKwiZEiy2wHQwp1BGVQqqEF0JMQ6YUyEPdgGGp7bitdgd5dro9HFVk3lO1kXwfo84jZIp5BY4SjF7xOXXGWTcME/jwRNPGcQcacgbVCKmnaXw+2xXyXp1B8LjaVfGrEMScpo8qIz02Ytt2nEazBeQ8TbYCdrOfHyd5ku0RGh83GkKpH8deHLOybBPxMJ3b9EEPtGU5jmU7iILGMbFsYruZ67I0YZ6bGVatMD7lc8N5GMf4xGLAXCBDQliGw1wg+zLPWf0BmIoMtkB1GEWj3aXles12Z4BHjgOdm6g7vmSM3xoWFuFH8odzabteGMWY4B7BQySokD9qDDDDMMKc3tRzhzA0JJSE7dnBbwWAuTjUoMsopmG41+PGCyZNOZLGZGfGD0asG+Pns7rnLDvxh+Z/yaNtWzhBwOwAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img13&quot; title src=&quot;/static/b94c16e95a70c9db14e938cdee93c991/b9e4f/img13.png&quot; srcset=&quot;/static/b94c16e95a70c9db14e938cdee93c991/cf440/img13.png 148w,
/static/b94c16e95a70c9db14e938cdee93c991/d2d38/img13.png 295w,
/static/b94c16e95a70c9db14e938cdee93c991/b9e4f/img13.png 590w,
/static/b94c16e95a70c9db14e938cdee93c991/f9b6a/img13.png 885w,
/static/b94c16e95a70c9db14e938cdee93c991/e9c61/img13.png 1080w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
     
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d35f943cd63f107baaf65bf538c16c62/e9c61/img14.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 216.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAEIklEQVRIx6VVS4scVRS+M4ngJDG28ZF5JJERA0JUxgcILl1okoWuRjEguMhPSGbjJhoiCoK4cSeKTjrBRwKuBHEjKD6IASfCZDr97q5Hv6u663XrPvyqbk9NkumumdHD5fa5VfWd75xzzzlNdk9OLBx99OjMgdnM1PwjmWPzc089NvfwfXsIIbsImYx3yL49U08/fvjQgX0vvfDM3AN7p/ffu2uCkHtOLs2e/iRz6oPMG+cffPPCQ6feP/jWh/sXz5GXz5DjS+TEWXL87OQrZ6Zee2f27Y8yi+8eOf3x/YvnMq+/t/vkEpnMyiNX5XM/yKlLknwlJ5Yl+TLaX/xJnvhZPv+jfPUXufeb+NUX0SvyeaRHKyvJ4Sw9djV89nsx/52Yucyms3TmUjiTDZ/81l+44j7xtbdwxTt0mR5cptMXw+mLao/XMiV/d8RKvfvrSu7azWKt67Z92XJ5yxOGK3UHu9Bd0fREa9Qiq7a8VdX//OP3a39dt2xbSsm5EAK/Il4y0TYvIv+HEMZ5o9Ho9/vqPBgMDMPodrumaUJxHCcNzDnvdDpBEKiz53nNZhOYdrsNo77vbwHu9XrAqLMzGMCWbhhADhwHegp5BLZtO2EA2O51Ow2zoWtQGqaZRDQajAgTsM9l2+cVh9d9/o/FPSa2cPt2sMtkL5SlfpjveZV+GDCeXNgIMO4UMQOP8KIQLKtSLA5sa/2Cpdgkd4ARlcJzxqDX6/WUOO92G7eSZBsmarWapmmFQqFYLELB22q1Wi6XcfM4VioVOy5EsEbMcDiJGTq+w0cwAYyu6zCHHUdYUXgU0hDMGIPPMIbasCxrh+XJGOoBhDCs/Ak8FwkTcX+MkyF4sz3NcgqtXtsLZcotJeANe0IwITSHmh5ruHRb4P/ekiB0XRddhQbATiFhVJNCbAMchiGuATlTbYycqwoR20BHzKgQcGJHwezMbcUMQlRCeuuPZmaxwArO2JUjSmgsfEwMUZEY8dzAju9QLaq2UTN40mq1sOObscxgwGtlHQqOyh1FjtQ1fO6PmgpDZhAqt5Hw1dXVXC6H7skXCrdyOTegn+bDssM31wyJp3wkihxKGAvbEG4zwUcV2zDbeiyIGaHm83k0Y6lUQuR4iNmQFrPiTMLm66IKPuXyI2aQIGywKWYch6PDMGqVCvxKY1YRqnPCGWWeC4+yLWaY+lsCLc5gRrbXcrnA7v3WEdlSIMc3ybAlk/kAW7Di43oZ61JhBiKlq4cxI6sGaptShj+9ajVA5ltt6Mw0A80Q6dlO7lmue7KhjO/NiBmJRaiqwuqatnLjxs21NSRcq9erNeS7DI8+y9O6e3eRReWp2ghgMGOeoEIxRvFwgOX7mMcBDa/3WB+Z53fImBkWuxo2W1TTdzAAb5/M1LJotzu8BTEi5/8Cftg+AXYvZMEAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img14&quot; title src=&quot;/static/d35f943cd63f107baaf65bf538c16c62/b9e4f/img14.png&quot; srcset=&quot;/static/d35f943cd63f107baaf65bf538c16c62/cf440/img14.png 148w,
/static/d35f943cd63f107baaf65bf538c16c62/d2d38/img14.png 295w,
/static/d35f943cd63f107baaf65bf538c16c62/b9e4f/img14.png 590w,
/static/d35f943cd63f107baaf65bf538c16c62/f9b6a/img14.png 885w,
/static/d35f943cd63f107baaf65bf538c16c62/e9c61/img14.png 1080w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;预期的效果是，点击&lt;code class=&quot;language-text&quot;&gt;点击下载&lt;/code&gt;按钮，图片变成加载状态也就是转菊花^_^。很简单吧？作为一个搬砖多年的前端，这种效果已经不知道实现多少遍了。但是这次却翻车了。&lt;/p&gt;
&lt;p&gt;咱们看下代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;&amp;lt;!--ui组件，--&gt;&lt;/span&gt;
...
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;v-for&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(img, index) in baseInfo.afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;:key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;@click&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;browerImages(baseInfo.afterRepairImgList, index)&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;img&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;img.img_localpath | urlFormat&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;a&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;v-if&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;img.needDownload&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;click-download&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;点击下载&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// data 数据绑定&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    baseInfo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 获取数据&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;getDetail&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;problem_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ProblemService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getProblemDetail&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;problem_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseInfo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_info &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 整改后照片（最多只能有三张图片）&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; afterRepairImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;afterRepairimglist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; k&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fixImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;afterRepairImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;slice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 点击操作&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;browerImages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;imageList&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; img &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; imageList&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;needDownload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;needDownload &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 如果需要手动下载，就显示菊花。问题就出自这里，数据（img.img_localpath）确实变了，但是页面并未刷新&lt;/span&gt;
    img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;img_localpath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;@assets/images/common/loading-3.gif&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    ProblemService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;downloadProblemImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;imgPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;img_localpath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; imgPath&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面的代码逻辑并不复杂，我们需要渲染的数据是&lt;code class=&quot;language-text&quot;&gt;data.baseInfo.afterRepairImgList&lt;/code&gt;，一个数组，其中控制菊花显示的是&lt;code class=&quot;language-text&quot;&gt;afterRepairImgList[x].needDownload&lt;/code&gt;属性。理论上讲，如果&lt;code class=&quot;language-text&quot;&gt;afterRepairImgList&lt;/code&gt;能够正常绑定到 vue 的数据响应式系统。那么我们调用&lt;code class=&quot;language-text&quot;&gt;browerImages()&lt;/code&gt;是能够正常显示加载状态的。但事实是出现了 bug。&lt;/p&gt;
&lt;h2&gt;解决方案&lt;/h2&gt;
&lt;p&gt;我们先说下遇到这种问题一些常用的解决方案：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用&lt;code class=&quot;language-text&quot;&gt;$forceUpdate&lt;/code&gt;，这种方案不用多说，会强制刷新当前组件。就是要注意一点别在&lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt;这个生命周期使用就行，不然会进入回调地狱。&lt;/li&gt;
&lt;li&gt;使用&lt;code class=&quot;language-text&quot;&gt;flag&lt;/code&gt;，这算是一种讨巧的方式，我们可以组件的根元素上面随便绑定一个属性，然后把该属性值放在&lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt;下，最后在 data change 的地方去触发这个 flag 变化，从而达到组件强制更新的目的。比如：&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:flag&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;flag&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;v-for&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(img, index) in baseInfo.afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;:key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token attr-name&quot;&gt;@click&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;browerImages(baseInfo.afterRepairImgList, index)&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;img&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:src&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;img.img_localpath | urlFormat&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;alt&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;a&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;v-if&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;img.needDownload&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;click-download&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;点击下载&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    flag&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    baseInfo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 确保afterRepairImgList能够被绑定上&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;


&lt;span class=&quot;token function&quot;&gt;browerImages&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;imageList&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
  img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;needDownload &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 变更flag， 强制触发组件更新&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flag&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;前面两种方式用起来快。但是总感觉过于粗暴，而且治标不治本。作为一个精益求精的 coder，我们应该寻求更加清晰且一劳永逸的方法。于是就有了下面的心路历程&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;方案三分析&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;追根溯源，产生问题的根本原因是什么？&lt;/strong&gt;
实际上原因就是我上面有提到的&lt;code class=&quot;language-text&quot;&gt;afterRepairImgList[x].needDownload&lt;/code&gt;没有被绑定到数据响应式系统。
&lt;strong&gt;顺便问大家一句，你如何用最快的速度去判断一个属性有没有被绑定？&lt;/strong&gt;
这个第一反应一般都是用 chrome 插件：&lt;a href=&quot;https://github.com/vuejs/vue-devtools&quot;&gt;vue devtools&lt;/a&gt;
其实有个超级简单的方式：直接用&lt;code class=&quot;language-text&quot;&gt;console.log&lt;/code&gt;，浏览器已经帮我们做好标记了，我们打印一下试试：&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/643100bc0c9c2fb0c26c282af7131568/68176/img17.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.604719764011804%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABlElEQVQoz52R207bUBBF/T+8QJu77WMnvidpINgRlMjyLYE6bRKnAcJNAvEE/PRmznEo6hvwsDSz50hL9ozUdnJ4gwUqcoo6m6CuEsoETW2KBpuKymmxU5EF2hb+/jbfZsnu/kJRXMEdXuDgaANvfw23t4buziG3Z1CN31CMGbQ2ZT0Ho5luU7ao0lvHmIN1yhkzc0g1JUNVzTAZb+AH57C6M3hOhq4dwzZjWEYMh6prRTCpb7IEu80E34i9N1rptk9JSLKdWoQi3CAcX2I0WuCgP8XAjeD3YgT9Et47ViIwjFTAe8tM/2XLTErhbj1CGN0jmjwiOLmB4S2haDm+014rckY1E7Wm0J7Vdxrq/5kj8WPU6BDeYIV+sAHrLkXmq6gopbC6rR9BkjtnSKYP8Md3CA8XOJZHqMsxyUrRZ5E0O0dx/kIXvkboLxE6CRqtdyH/g6roP4bErBzzv8/wf15jeHILvbdCUz8Tj5+VCaHGhatncYz94ALOjyVa7VJY/arwT/GEw+Mr9IZrISuvm37pK18BH6qhwl1eukkAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img17&quot; title src=&quot;/static/643100bc0c9c2fb0c26c282af7131568/b9e4f/img17.png&quot; srcset=&quot;/static/643100bc0c9c2fb0c26c282af7131568/cf440/img17.png 148w,
/static/643100bc0c9c2fb0c26c282af7131568/d2d38/img17.png 295w,
/static/643100bc0c9c2fb0c26c282af7131568/b9e4f/img17.png 590w,
/static/643100bc0c9c2fb0c26c282af7131568/f9b6a/img17.png 885w,
/static/643100bc0c9c2fb0c26c282af7131568/2d849/img17.png 1180w,
/static/643100bc0c9c2fb0c26c282af7131568/68176/img17.png 1356w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;如图，只要是后面带小眼睛图标的都是被绑定监听的，且只有点击才触发。可以看到&lt;code class=&quot;language-text&quot;&gt;needDownload&lt;/code&gt;没有被监听到。其实这个 console.log 包含的信息远不止这些，比如属性我们平时学 vue 原理常见的 Observer、Dep、Watcher 等都有体现。这更加方便我们在实践中理解 vue 的基本原理。&lt;/p&gt;
&lt;p&gt;ok, 回归正题，基于以上我们作几个猜想，来分析问题原因。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;猜想 1:&lt;/strong&gt; 难道是因为数据过于复杂，对象嵌套数组，数组里面又有对象，如此反复，导致&lt;code class=&quot;language-text&quot;&gt;needDownload&lt;/code&gt;不能被 watch ？&lt;/p&gt;
&lt;p&gt;针对这点我们可以做个实验:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 我们写一个5层嵌套的复杂对象&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  dataInfo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;000-000-000&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;111&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;111-222&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;111-222-333&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;111-222-333-444&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;222&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;222-222&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;222-222-333&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;222-222-333-444&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;changeThis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;-&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后渲染出来，点击末端按钮，然后按钮的名字会变化。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;v-for&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(item, index) in dataInfo.list&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{ item.id }}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;v-for&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(i, idx) in item.list&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;idx&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{ i.id }}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;v-for&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(r, idr) in i.list&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;idr&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{ r.id }}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
              &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;v-for&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;(o, ido) in r.list&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;:key&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;ido&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;button&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;@click&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;changeThis(o)&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;{{ o.id }}&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;button&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
              &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
            &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;初始化为左图，渲染为右图&lt;/p&gt;
&lt;p&gt;
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b2f2e35be8ff4073c6a18ca08b81bfa0/f0a9a/img15.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 115.9468438538206%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAB5klEQVQ4y61V2YoCMRCc//8gHxQVVFTE+8ATb7xvxVtrqYYMMc64I7uBJiGTtNWVqtZqt9solUqYTqcydzod9Pt95HI5bLdbcDyfT3gdFi9Xq1WMRiPU63X0ej10u11UKhXsdrvvE/524JtkdsLZbIbVaoVCoYD5fC4f7vc7Ho+HhErqJbmlX/4PpJZ+kOvT6YTFYiFcTiYTFItFLJdL+7se+t4LQv3j4XDAZrORR2LSWq0mdHhFbXkt6Xa74Xq9yjnOpMlE7YhQrSkZhZCRz+cRDodlz+/3y54TDZZbGXwkhYhrIlKoPD2KE+FqkFfGeDxGs9kURzUaDZTLZUFKY6zX69eSzST6Hm1JrdKWtGQ0GkU6nUYikUAsFkMkEpEfe5ON0qMpJa/D5pDuoPZSqZR4WCVVYbrFKV5kQ/IZ5IFcfULwKd5KVmXv93sMBgNxCNFzrazp5pY3p6jS2AP5CJlMBq1WS141m82KsM3Lf3KK0qZ53rzn6hSWzW7OZkt5DIdDmak/6i6ZTNqtTn80y0175PJ8Pkuj4EV2Ic7H41GC+2bLc7SeUxlUABNSBWxpFDl5ppjZlViF6kiuXtbR8hKT0CU+nw+hUEgaRSAQQDweRzAYFCq+/k8hBZfLxZ4ZqpVRBTz7A0Bs+7yoZ6z0AAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img15&quot; title src=&quot;/static/b2f2e35be8ff4073c6a18ca08b81bfa0/b9e4f/img15.png&quot; srcset=&quot;/static/b2f2e35be8ff4073c6a18ca08b81bfa0/cf440/img15.png 148w,
/static/b2f2e35be8ff4073c6a18ca08b81bfa0/d2d38/img15.png 295w,
/static/b2f2e35be8ff4073c6a18ca08b81bfa0/b9e4f/img15.png 590w,
/static/b2f2e35be8ff4073c6a18ca08b81bfa0/f0a9a/img15.png 602w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/64f904059ea2acdc323e685b5240b757/34e8a/img16.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 114.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4klEQVQ4y6WV14rCUBCG8/4PpIIoXiioN3ZR7L13xe4s30CCmz0xkQ0MJxcnU/4ysYbDoZTLZVksFlKr1aTdbstkMpFisSir1Up4Xq+XBH2swWAghUJBSFytVqXRaEiv15N8Pi/L5fL7hH4XvknmJNxsNjIajSSXy+k7z/1+l+fzqWEn5fQroAn56PF4yPl81vf/dGq5L95uN9nv99rxbrdTkt7JeQ9TMcs9yuFwkPV6Lc1mU7rdrmQyGYE408jvUBhJ8RvLhKX7G8vrAngyLnIqlUqq0XQ67XSNTsHdDYPl1QXkXC4XxZQTXNEl7PN+Op0+k+IFuC0hO2m/35fZbKakEePxWKfAaTRhmZK5E0MSiXBQKBSSaDSqkUwmJZVKSSQSkUqlooUtLyJMoDO+rVl3kMzBkFHm87kCDwFc8IPho1Ou16scj0cHj09d+4VxZDpE4BSyizFSEK3+IQW7TadTicfjqjUiFovJdrt15MQ999L46JRvVpbRKaYLjIq27LUGvkijXq8rztlsVjf7e9e/nOLuDomQkGi1WuoStEgBdIkFgSfQxvYamSJ4nMA5nJAHaVjRcYoXjvaypbtOp6P/G5ySSCQct4TDYXUK606dEnRd2VKCbX4TjMvJ+ARd0sAPno76zMSiVCEAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img16&quot; title src=&quot;/static/64f904059ea2acdc323e685b5240b757/b9e4f/img16.png&quot; srcset=&quot;/static/64f904059ea2acdc323e685b5240b757/cf440/img16.png 148w,
/static/64f904059ea2acdc323e685b5240b757/d2d38/img16.png 295w,
/static/64f904059ea2acdc323e685b5240b757/b9e4f/img16.png 590w,
/static/64f904059ea2acdc323e685b5240b757/34e8a/img16.png 600w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;可以看到一切正常，猜想 1 不成立。其实 vue 的数据响应机制绑定数据的规则是，对复杂对象或者数组进行递归，类似与 deepClone 算法，&lt;strong&gt;遇到&lt;/strong&gt;属性就进行劫持加 watch 等一系列操作。所以理论上讲，不管你对象结构有多复杂，vue 都能给你绑定上。数据的复杂度毫无影响。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;猜想 2:&lt;/strong&gt; 数组的一些常规操作例如：&lt;code class=&quot;language-text&quot;&gt;pop, push, shift&lt;/code&gt;等会导致数组无法被劫持监听？&lt;/p&gt;
&lt;p&gt;实际上这个也是不成立了，vue 源码里面明确对这些变异方法 (mutation method)做了重写：包括 7 种&lt;code class=&quot;language-text&quot;&gt;push,pop,shift,unshift,splice,sort,reverse&lt;/code&gt;。使得这些方法调用时候不影响劫持监听。&lt;/p&gt;
&lt;p&gt;能影响数组劫持监听的就两种情况：&lt;/p&gt;
&lt;p&gt;1.当你利用索引直接设置一个项时，例如：vm.items[index] = newValue&lt;/p&gt;
&lt;p&gt;2.当你修改数组的长度时，例如：vm.items.length = newLength&lt;/p&gt;
&lt;p&gt;检查下代码，没有这两种操作，猜想 2 排除。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;猜想 3：&lt;/strong&gt;给对象新增属性会导致新增属性无法被监听劫持，是这个吗？&lt;/p&gt;
&lt;p&gt;这也是我能想到的最后一种可能影响，也是概率最大的。我们再会看一下代码，在最开始我们直接在 data 上就绑定好了&lt;code class=&quot;language-text&quot;&gt;afterRepairImgList&lt;/code&gt;，但是最后他并没有被劫持，只有可能他的父级直接被重写了，果然，我们看到了这段代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ProblemService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getProblemDetail&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;problem_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 这里直接赋值了&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseInfo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_info &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; afterRepairImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;afterRepairimglist&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; k&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 虽然这里又重新给baseInfo.afterRepairImgList赋值了，但这算是新增属性&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fixImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;afterRepairImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;slice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;由于 data.base&lt;em&gt;info 里面没有 afterRepairimglist 这个属性，所以后面的代码属于新增属性操作。但是还有一点疑问： `data.base&lt;/em&gt;info` 不是对象吗？它是引用类型啊，我在后面赋值对他应该没有影响才对啊？ 实际上这是一个理解误区，混淆了劫持和代码执行的概念。vue 的劫持是在赋值那一瞬间执行的，真实的情况应该是这样：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baseInfo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_info &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//2. vue源码开始运作，进行一系列劫持监听操作&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;//3&lt;/span&gt;
data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base_info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;afterRepairImgList &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; afterRepairImgList&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;slice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们把&lt;code class=&quot;language-text&quot;&gt;this.baseInfo = data.base_info || {}&lt;/code&gt;这段代码放在最后，果然 bugfree&lt;/p&gt;
&lt;h2&gt;总结&lt;/h2&gt;
&lt;p&gt;以上可以看出，这个问题的原因很简单，解决方式也很简单：&lt;strong&gt;只要是涉及到的 data 属性结构相对复杂，那么他们的赋值操作就尽量放在函数内的最下面&lt;/strong&gt;。相信我，这个习惯会解决 90%类似的问题。&lt;/p&gt;
&lt;p&gt;往往简单的东西最容易被忽略。vue 数据劫持的原理大家都清楚，但有时候真遇到类似问题却很少第一时间按照原理逐步分析，抽丝剥茧，因为实践中经常因为数据太复杂或者业务逻辑嵌套过深而忽略这方面的思考。&lt;/p&gt;
&lt;p&gt;还有一点，这个图也容易给人造成误解, 以为 data 下的属性只会劫持一次&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a7d73316b8cc8d66b9580dec8a60e39f/a5d5c/img18.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 53.42465753424658%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqklEQVQoz21Si46jMAzk/z/wVO220Kot5ZEACYFACMza7hb17mppZBM5g2ecZF1X/ItlWTDPQRDCgleEuKCZHdrgENcoZ9wfY9zvJvzxxCJEHErVOB6/kGVH5Pkd4zii1Q0ubYFs0UiDQmEUemPlzrZtO2lCNV7gmKaA6+0bVX2Abr5QVhkejwJd12GYPFTooeceRVXC04/O5zOstUIqhLavYEwpsL2hbNG2NYwtBX3f7pI3lkWTYN1gqc8YA++95Jf8ROkDivIPanXA/X6hw02mDSGSnCe4UQi3TcChtabJHyKZ8zRNIjvpnYJzmqYjT2jCrjO43U5o2gxNk1LOyUOPuq7ou6GeHlVVCWGWZTTMiazJoHSG0btfD1ce9ykrxpUuX2nib2ripZyIxGEYnHg1+vHp5zDImW5OaLuj+D2O9n3Lcd8U5zzPadtKpHDdtuTlhn17fF4UvKyafCTvLfd6JJ/eISOEIP5w7ZxDfr9Ddw1M9LDTgDRNRfr7C2F/d8L36d4fKtccTH5xNdKJ3qij7Y/Dr0V/q/uP8FP9+rZhxNU3ULPFJ6sYPwGyU4LKx2Z3AAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img18&quot; title src=&quot;/static/a7d73316b8cc8d66b9580dec8a60e39f/b9e4f/img18.png&quot; srcset=&quot;/static/a7d73316b8cc8d66b9580dec8a60e39f/cf440/img18.png 148w,
/static/a7d73316b8cc8d66b9580dec8a60e39f/d2d38/img18.png 295w,
/static/a7d73316b8cc8d66b9580dec8a60e39f/b9e4f/img18.png 590w,
/static/a7d73316b8cc8d66b9580dec8a60e39f/f9b6a/img18.png 885w,
/static/a7d73316b8cc8d66b9580dec8a60e39f/2d849/img18.png 1180w,
/static/a7d73316b8cc8d66b9580dec8a60e39f/a5d5c/img18.png 1460w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;应该加条线，如下：&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d8009285d5eb3d0448f3a2f56b021a7e/a5d5c/img19.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 53.42465753424658%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABlElEQVQoz11Si46bMBDk/3+wyiUBekcwGL/WxvEL7K7NtToVjSweu7Mzs3THeSJSOxExJR8iIqSUS0GEI/FoRbTxPPGxluGFZ85dOo4L8ThKKRvb7o+Pfni8yGydl1z9VrQ/1TOJGbjWBtnPnNNRJ3Vno6+cpeDAz+m+sNsm78s6TgthiqlgFsdZ3Ald384N46i1xv7aDJoqWCWsYECBFlhtqNqZZkuw0iSc9rJWIDkASADnPWh96e+ouBH6i/LbNH822zmmA5FqALE4jyOarMI4nwlBd2QhPgR02uld6F2CEWC0VPA1PZkYmBy4JNb7lW1M4CezrBSb+3GY134T48ZH+947pK04q3OMgm7Tyh5UPCfSg9mNtSjSOieV2q1FILWAHkPZ37qljatqgR/tBrUxLtDbixAhZc4lN93OO7JiOuzttdLCB9/9t2eEj3XJyIJjX/PMQKrT6+Cew7BQeimtC8LAvnuusT8oUls7bnW07BHYw1LtbKnWsPJo59/mS/NPFdcb/KkguS8vt2j+WftGzn8A4Ht3UdyystQAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img19&quot; title src=&quot;/static/d8009285d5eb3d0448f3a2f56b021a7e/b9e4f/img19.png&quot; srcset=&quot;/static/d8009285d5eb3d0448f3a2f56b021a7e/cf440/img19.png 148w,
/static/d8009285d5eb3d0448f3a2f56b021a7e/d2d38/img19.png 295w,
/static/d8009285d5eb3d0448f3a2f56b021a7e/b9e4f/img19.png 590w,
/static/d8009285d5eb3d0448f3a2f56b021a7e/f9b6a/img19.png 885w,
/static/d8009285d5eb3d0448f3a2f56b021a7e/2d849/img19.png 1180w,
/static/d8009285d5eb3d0448f3a2f56b021a7e/a5d5c/img19.png 1460w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;最后的最后，给大家出个小问题，如图，这种情况是怎么形成的？&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e81b53b6e67a68dab72831373dd9b385/cfd63/img20.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 33.42579750346741%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABqElEQVQoz02R247SYBSF+zDGMaPRmRFoaUtpy2kaVIZwMMBwKLSWHpgQRSbGSMZ7442J+gbe+AC+3eemUePFylrJblbXl18ZT3doToztbajUUyo1USOhbMeU3QTLjWk1Uur1oyfUWzGGE2E5Sa48N2JUK+CpvkQJwx2D/o5+d8uLdoYnxWN3SmT2aFszRs8zftze8XN/4Nfuli/ZOzQ7oiIjTHuN6axlxBqtGlKqBChldcphtmZxFTNpR4zrcwbmhFozxnUj3FpC4zLFa25oNSULhS2LbLk7QuO4WV5clfV2M0WxtGvepge684+4nV1+8IwxFX2GZvicmQEXxorHZZ97hQUnpQX3Sz4nxQUPxC8Es2iuKBjLXEpFCt+He4LlB0aDN3QvIzr6SyZqR3RFtzykqk3oeRHfotd88m/47qd8fbXl82qL7YT/So9SVHPJ9bNIkBOGrYC2PsIyZjwxQ1T5o2EsKOoLQY1YD26Yd2KyQUY23BD0MvSqPIbxX+EsuKM/PeD19pwL3pkhH8ihdEQQP+ajn8uKU8F9pPmcqn6eH4r/LSv88d+DHBGy7YunLgAAAABJRU5ErkJggg==&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img20&quot; title src=&quot;/static/e81b53b6e67a68dab72831373dd9b385/b9e4f/img20.png&quot; srcset=&quot;/static/e81b53b6e67a68dab72831373dd9b385/cf440/img20.png 148w,
/static/e81b53b6e67a68dab72831373dd9b385/d2d38/img20.png 295w,
/static/e81b53b6e67a68dab72831373dd9b385/b9e4f/img20.png 590w,
/static/e81b53b6e67a68dab72831373dd9b385/f9b6a/img20.png 885w,
/static/e81b53b6e67a68dab72831373dd9b385/2d849/img20.png 1180w,
/static/e81b53b6e67a68dab72831373dd9b385/cfd63/img20.png 1442w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    </content:encoded></item><item><title><![CDATA[JavaScript怎么做单元测试]]></title><description><![CDATA[测试分类 首先对于来讲，什么是测试（我们这里的说的都是自动化测试）？测试其实分为三类： 单元测试(Unit testing) , 关注应用中每个零部件(function or procedure)的正常运转，防止后续修改影响之前的组件。 功能测试(Functional…]]></description><link>http://wuhub.top/how-to-do-unit-test/</link><guid isPermaLink="false">http://wuhub.top/how-to-do-unit-test/</guid><pubDate>Tue, 24 Sep 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h3&gt;测试分类&lt;/h3&gt;
&lt;p&gt;首先对于&lt;code class=&quot;language-text&quot;&gt;JavaScript&lt;/code&gt;来讲，什么是测试（我们这里的说的都是自动化测试）？测试其实分为三类：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;单元测试(Unit testing) , 关注应用中每个零部件(function or procedure)的正常运转，防止后续修改影响之前的组件。&lt;/li&gt;
&lt;li&gt;功能测试(Functional testing), 确保其整体表现符合预期，关注能否让用户正常使用。&lt;/li&gt;
&lt;li&gt;整合测试(Integration testing), 确保单独运行正常的零部件整合到一起之后依然能正常运行。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;其中整合测试很大程度上和单元测试是类似的，他们用的测试工具是一样的，但是他们有个很大的不同：单测的每个组件是相互独立的，而整合测试则恰恰相反，比如，单测里面访问 DB 的代码，不会与真实数据库对话。&lt;/p&gt;
&lt;p&gt;使用整合测试的场景一般出现在单测无法满足需求的情况下，有时候你必须验证两个独立的系统之间的交互通信是否正常，比如你的应用和数据库之间。那么就需要用到整合测试。&lt;/p&gt;
&lt;p&gt;因为涉及多个独立系统或者组件的之间交互，所以整合测试往往要比单测要慢，而且需要一些设定和配置，比如设置一个用来测试的 DB 环境，这使得它的开发和维护成本也变高了。所以我们应该把焦点放在单测上面。除非你确实需要它。&lt;/p&gt;
&lt;p&gt;至于功能测试，他还有其他名字，就是 e2e 测试，浏览器测试。这个之前在架构组提供的移动端脚手架集成过（cypress，当下很流行的端对端测试框架，文档超级友好），不过因为咱们使用率较低，而且 cypress 体积比较大，影响依赖安装速度。所以被干掉了。功能测试针对的是应用的各个完整功能模块，通过一些工具，模拟浏览器事件也就是用户的操作行为，从而做到 web 自动化测试。我们可能用单测去测试一个独立的函数方法，或者用整合测试去测两个系统是否交互正常。但是功能测试它完全是另一个层面的东西。我们可以为一个应用去写上百个单测，但是通常只需要写少数的功能测试。主要原因是功能测试有较高的复杂度，而且运行很慢，因为你需要去模拟真实用户的各种行为，包括页面加载时间也是一个测试点。功能测试实际上和我们测试同学的工作是重合的&lt;/p&gt;
&lt;p&gt;功能测试的应用场景是，如果你有比较多重复的手动操作，比如登陆注册这种功能。但是要特别注意注意测试粒度不宜过大，那将会带来沉重的维护负担。
如果大家对功能测试有兴趣的话，后续咱们可以单独开个专题讲这个。今天我们主要讲单测。&lt;/p&gt;
&lt;table&gt;
  &lt;tr&gt;&lt;th&gt;测试类型&lt;/th&gt;&lt;th&gt;工具&lt;/th&gt;&lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Unit Testing&lt;/td&gt;
    &lt;td&gt;Mocha, Jasmine, Jest, Cucumber, Tape
    &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Unit Integration&lt;/td&gt;&lt;td&gt;Mocha, Jasmine, Jest, Cucumber, Tape&lt;/td&gt;&lt;/tr&gt;
  &lt;tr&gt;&lt;td&gt;Functional Testing&lt;/td&gt;&lt;td&gt;Selenium, Cypress, Nightwatch, Testcafe&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;
&lt;hr&gt;
&lt;h3&gt;为什么要做单测？（或者说为啥要做自动化测试）&lt;/h3&gt;
&lt;p&gt;首先，自动化测试是持续集成的必要基石，是一种能让你用更短的时间将更改发布到生产的开发方法。它能在用户接触到应用之前让你发现更多的错误，从而让应用更加的稳定。这使得你开发起来更加安心，不用害怕使用中出现一些未知的错误。&lt;/p&gt;
&lt;p&gt;总的来讲，写测试用例可能会占用一些你的开发时间，但是缺少它，你将会失去更多，例如：&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;bugs 会影响用户体验，进而影响你的产品销售额和使用指标，更严重的可能会永久失去用户。&lt;/li&gt;
&lt;li&gt;复现一个 bug 可能会花费 QA 或者开发者 20 分钟时间。&lt;/li&gt;
&lt;li&gt;开发人员断点调试定位问题代码，每次断点分析又得花 20 分钟，这还没算上 bug 调试时间&lt;/li&gt;
&lt;li&gt;容易出现正常功能开发之外的 bug，比如有不熟悉代码的其他同事修改了代码，但是遗留的另一个 bug&lt;/li&gt;
&lt;li&gt;-&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[页面水印插件开发]]></title><description><![CDATA[客服组 app…]]></description><link>http://wuhub.top/the-development-of-page-watermark/</link><guid isPermaLink="false">http://wuhub.top/the-development-of-page-watermark/</guid><pubDate>Thu, 15 Aug 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;客服组 app 风险管控的学习坊模块需要这样的功能。目的是为了客户的信息安全考虑。防止截图外泄。有了水印，第一可以起到警示的作用，比如用户看到这种水印，就自然觉得这是敏感信息。第二可以当作泄露证据，因为水印信息一般就是使用者的信息。
我们这里的水印并不是大家印象中的图片水印。它是打在页面上的。可想而知，图片是死的，打一次水印就好。但是页面是动态的。怎么做呢？&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;方案一：背景水印&lt;/h3&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/38a7897e0dfc6a945de210f2acb43653/1a1ab/img01.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 354px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 177.40112994350284%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAjCAYAAACU9ioYAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFu0lEQVRIx5VWW09UVxQ+P6LP/QNN+tQmvvXFB1NFJWIivWmpBlupbVQUQazWilZFE9ukaehFrVAFBVEU6qUaofBQHxQpMAMMc59znXOZGwMDX9faZ4YZQE07yZe1z95rf3vtddsjlR/swKb6dmw+1IGNde1YV3sFZbVXsW7fVWw40I5ymmNZVtuOjSQrGjqwOY+K+g7xzXJDXSsqGlshVdRfw44TN7F+/xVsb7qBXadv0fct1DTfwY6mbnx26iZ2nurGR0c76fsGNtV1YN2eqyjbWwR/n20bxNavuyFVHu7CB0e6sKXxOhF149OmDlQ1/Izqo7+huqkLXzTfxm5C9clucdiHX5Fuw3VUHupEZUMeNN57/g9sO9YFyeuLwEPwTkcwGVQw7vXhn2dPMT42Bq8vCF4vwDMVFnJiOg8xH6L5EEY8AYyTlMx4HHEjDkPXkEomkLBMKP4J2HYcyURCrLHOUpg0b0DXNLGPx5aYNyCpqg5FUcFSjoQQHBvGw85LGB15CtOyaE0Xa8vB88oL5vOEGjTNgKbKCAenECILdU1FnCzhNdbhdVU1lsjCuHReMnQy1U5AN0zouo5oNIyYHIEsK4jFZCJUSJEPfLGl7mFFKU36Qxh/+gxyMIhwJIZQKELEfJoifKRpbKEqZCncQ4qyAOn2g35caj6HkaFBxOh64XAY0VhMLMZIqqyo64KU4VqsLh5UgKa5UvIHQvBN+YVVj/58gJrqKmwpX4P6+v04ee4cGo8exu9tl2FQJGVZfiFhqdWSTj7k+2cyM6g7uB9vvP4aDlS+i/P7qvB1Yy1Wr12L4yea4DiOINNe4obCt4iyLKtIpWZw9Pg3WLPqTXy/dyd+PbgDPxyvx3s7a3C+5RfYIoWUJVYVXFA4SFyZw60QoWnZONt8Bp+UrUbz7o/x455tOP1lFd5ZX45jZ7+DYztLrstjdsHyAwQhW5hMpnCgoR5vr3oLn79PJLu2oW5fDcoqNgjLlxOuiLzqQirkkq6bGBsdxZMnf+P58HOMEManfAiFA5RKAVLWi/7iiL4EUmmCmqYNx0pSXdpUn6bIQ1UmIq4GugW7RuWqYvKXQETZMCzabLhlJrvQqFYDfuo2Xi884x54PSQ9HvinA9C51GhdV4wVkIKhIDyTXkRiiluPpMjKTBoVlROm+mZEEKZxJBIVviqQrrCwq/cWznx7BEP3esgHVMu0gZM84SQoldJIExKJpGgUrvPdAxcJS8YspbbOLtRsrcLDtovo/2sInZ2dIuOHh4fR29eLnp4eDA4OUbCewKLUKt1cQCmpFAyH0P94gCI8hrv37uPOnV7MzMygv78fFy5cQEtLC/r6+jAwMJAPiOsr4RaFA6UIuUioU8e1LFO0ntnZObzql05nhI95M5MzWdE6w/VhsXxUsWF+fl4gl8sRCjKHhYUFZGh9+XVLgyOiLEqHnC2z2RQMg98Xfi90Q1jN0MWcKeb0FYTLotxz/zZaW1sw9Oi+aLABf4AeHvaPW2Y6E2qGkKIACmmVl8vzUfqp9TK2V1bi7sUWJKmFRTULsuFAt5MwE2kYdkrAdFJI03o2O1uCrKio0nyUvJM+XGu/jqH+x5idy2FaS2BStjBFGI+YmIzZmFYd+AiZ2dyKQJmmWWwY3A/ZN0lKXn4y0+k0/JpDRHFB6omaeBYwBHGGMmCOgpWlQ2cpSPMUJEacCBVuDLpWbA5cwwyujKCeFAQjoThGiZjHEzFLWDop25ggxKw05vMWGlYcMj1oLiFZWCDjZ1OUFj8JBFlzoVBb0+OWgMagRmJaDmzHzv8RUMTeQsAkixa5bXGtxmmDRWMuMVvAEWOB/DxjUZ+u61iJvB7BdCDZ9Mizhdks+Whunqol95/Autz6olEZCer2LFOpDP1ZotNi1LoymaxQZOJsNvcKzAnkcguCZGLCR8GcETm8SGialgBf+f+Ar8k3NIU7XNf9C4wqtalXwCVDAAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img01&quot; title src=&quot;/static/38a7897e0dfc6a945de210f2acb43653/1a1ab/img01.png&quot; srcset=&quot;/static/38a7897e0dfc6a945de210f2acb43653/cf440/img01.png 148w,
/static/38a7897e0dfc6a945de210f2acb43653/d2d38/img01.png 295w,
/static/38a7897e0dfc6a945de210f2acb43653/1a1ab/img01.png 354w&quot; sizes=&quot;(max-width: 354px) 100vw, 354px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;这个也是最普遍的水印方式。一般有两种实现方式：1.给底层元素设置背景图片（比如，用多个小图平铺，&lt;code class=&quot;language-text&quot;&gt;background&lt;/code&gt; 设置 &lt;code class=&quot;language-text&quot;&gt;repeat&lt;/code&gt;，或者直接仍一整张图）。2.直接用绝对定位的方式在底层 dom 平铺 dom 元素。那么第一种方式如果要变成动态的，就得用 &lt;code class=&quot;language-text&quot;&gt;canvas&lt;/code&gt; 先画好，然后再通过它提供给的 API -&gt; &lt;code class=&quot;language-text&quot;&gt;toDataURL&lt;/code&gt; 将画布转换成 &lt;code class=&quot;language-text&quot;&gt;base64&lt;/code&gt; 的图片即可。&lt;/p&gt;
&lt;p&gt;但是种方案有个问题，就是不像聊天框，界面比较简单，但是前端页面是动态多变的，有些页面甚至可以完全遮挡住顶层 dom。所以这种方案显然是行不通的。&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;方案二：遮罩水印&lt;/h3&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/45e515ca5c09a787a9ac280555d75c1e/6c314/img02.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 544px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 177.75735294117646%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAABcSAAAXEgFnn9JSAAAE1ElEQVRIx51UTW8cNRh2ulRpummiJmkEEvQAUlUO/AiKQFQVFESBC4JfUII4cGsiDhzgABKVKvFxQ0gF1BahlpYiQEKonFCbj002ye5msslust+79ow9tmfGPB4ny8KpZfTKesdjv/M+HzbJPpR5dGxk6lAmM0T+87iJYUKmRw8+Mn7o4bHD02Mj00eGH5saPX5s/OSTU2T43LsTb81NvHnh4Nl3MmfOZ868nTk9k3l+5sBzM+TZGXLq/PDp9yZfmZ06Nzfx0uzEixeOvfz+5Nm5yRdmj7/xAcn+YaZ+N+Rnc+C2ITfN0A0zdN2Qq+bo9+apW+bkj+bxa4Z8aYa+MOQzQy4ZcjGNjw350JCjN/n0DXHkejT+gx69Ema/5dnL4fBX4dTX/MR3/olv6BOX+cjnKnspPHwRIbOfasToJ1H2I0k8Hns8WWmy+Uoz32RlnmyyqBwk6111t0Lna3zBa3k15vmJR+PVBs9VerkqXfOa5bYiSZIYY2o7lfzKcqtZR+5mpOC17c1Wfbe9s22UtFPGdFv16pZXrZR5u26SmIRKhjIMtP5r12/7QikpwhAzUqkojhA8FEEosEzIUMWRTkMlEQsCwgI/TpIoiqQM3T8TG0mMDkyCdSgVJyhjHx1prSN80yrqUUqkVrVGfX5xobhRWius59dWS97GerGwuVXG68LSYrFUZIz14USJrnRLOz0PtQg+dGmv0Wq2u51mu+WSVqeNfKe2W2828FUp1d8MXG3WEBFDD6TT7eDnaMWBcQlGIQSSOO1caQ0KXAR+oBXatwuIzwNASlKEFiTAa3ClQRVGl+t9nlxdu86YUErLNhpbWc3nV/OAilopsDhOObMBOtPXyOAfRkZhlZZqQVkpTXgqA7BtVbYBFX9O9gg3jnAu+P6kBY1CgaKBpsxnVir0hhUogQ4xohwkRVcYqc8CHlgvDASQ+wHHRotZhKKvsHvcf6SS8Z488QDsOBQS7kEVQhmr1WuLuaW19TWIDPCFUnG9ULCar+bta7FIGXUlUMnnrNxeqwdbkIAEgkspoSpo6/S6gA3rdLrdHu31GG00m5gELrNHgdGxFlGAkNjsp5CAti9Mf7RJrB0RwO8iTOkIIXjI7ea0n0Ra7aM+yU4naymND2pQ6jhlCERab0MnoHVOzq0sO4cX4fDC+uLSIugAoj5mqzPbqNINn/kEnXAhABIJ2AdOjFYhwSmltXodrQ10ZEdfUiao9TboAeHKIdxHbk8iavl+OqMGMQec9xiD1LCGPRhRHO8fYPsAEnKsw3zarbVnP2AhlN7ztsO8nF+BsReXlnK5HAR3agM5zjnyf2GOZYUWd33P6uy8DZxADjMAM0A6zEggMhI0n5KfHg+cVlxNsbCbsc3qrBVuBZG2NKgzXllayLlaWPDwNo63BsdWZwC2h1brfyhN9u4wEANsfcD9Y4/t2Ejceby3MA9suMZw9UBtXGDI787fA3JXyDXstYNCy1+otkotituEgAx4Bc2jkmuPpkA6eHpdizb1U9oU2IqBgfEQTQIpwQrrWAfJuTdNXCFroVD0A6T4KA13K+m7e7uXknz/gbq4YVGLQJX7D3sNR/rOn3deff21W7d/euDNEO+X3359+plTV65dfbDNLoB2s7xp77D/sRnh7sa/AcDDeGJth2IPAAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img02&quot; title src=&quot;/static/45e515ca5c09a787a9ac280555d75c1e/6c314/img02.png&quot; srcset=&quot;/static/45e515ca5c09a787a9ac280555d75c1e/cf440/img02.png 148w,
/static/45e515ca5c09a787a9ac280555d75c1e/d2d38/img02.png 295w,
/static/45e515ca5c09a787a9ac280555d75c1e/6c314/img02.png 544w&quot; sizes=&quot;(max-width: 544px) 100vw, 544px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;顾名思义，就是把水印盖在整个页面上，如图。这样就能保证水印能够完全保留。下面我们说下实现方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;用 dom 实现&lt;/li&gt;
&lt;li&gt;获取水印容器的宽高，根据水印的尺寸计算水印显示的行数和列数&lt;/li&gt;
&lt;li&gt;两个循环，分别循环行和列，创建水印 Dom&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;为什么用 dom 呢？第一，简单，而且能满足我们的需求。第二，相对于 canvas 它的定制性更高一点，因为一般我们如果用 canvas 实现，最好的方式是用 canvas 画一个最小单位的水印，然后转成图片进行平铺，它的每一个水印都是一样的，像上图这种，用 canvas 可以，但是如果我们要多次定制水印的显示效果，那就比较复杂了。&lt;/p&gt;
&lt;p&gt;这里根据水印的尺寸计算行数列数。如果我们的水印是带有倾斜角度的，就需要用正弦或者余弦函数去计算水印 dom 的具体宽高。但是这种方案会有一个问题，就是既然水印盖在页面上，那就势必为会影响原本页面的 dom 操作。比如页面滑动点击拖拽等，因为我们的操作统一会被这层水印给接收。所以，我们得想办法在我们做各类 dom 事件操作的时候直接忽略掉这层 dom。&lt;/p&gt;
&lt;p&gt;这里我们用到了 css 提供的一个属性：&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/CSS/pointer-events&quot;&gt;pointer-events
&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;它能指定在什么情况下 (如果有) 某个特定的图形元素可以成为鼠标事件的  target。它的产生主要是为 svg 服务的。以下是它的的所有属性值：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* Keyword values */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; auto&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; none&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; visiblePainted&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; visibleFill&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; visibleStroke&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; visible&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; painted&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fill&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; stroke&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* SVG only */&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/* Global values */&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inherit&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; initial&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token property&quot;&gt;pointer-events&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; unset&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到，它有 11 种属性，有 9 种仅限于&lt;code class=&quot;language-text&quot;&gt;svg&lt;/code&gt;使用。所以我们能用的就两个： &lt;code class=&quot;language-text&quot;&gt;auto&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果值为&lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt;，元素永远不会成为鼠标事件的 target。但是，当其后代元素的 pointer-events 属性指定其他值时，鼠标事件可以指向后代元素，在这种情况下，鼠标事件将在捕获或冒泡阶段触发父元素的事件侦听器。&lt;/p&gt;
&lt;p&gt;通过这个属性呢我们就可以实现我们之前的穿透水印遮罩的需求了。该属性也可用来提高滚动时的帧频。因为，当滚动时，鼠标悬停在某些元素上，则触发其上的&lt;code class=&quot;language-text&quot;&gt;hover&lt;/code&gt;效果，然而这些影响通常不被用户注意，并多半导致滚动出现问题。对 body 元素应用&lt;code class=&quot;language-text&quot;&gt;pointer-events：none&lt;/code&gt;，禁用了包括 hover 在内的鼠标事件，从而提高滚动性能。&lt;/p&gt;
&lt;p&gt;实际上到这里我们所有需要准备的东西已经都备齐了，具体代码这里就不展示了，感兴趣的同学可以直接看&lt;a href=&quot;https://git.mysre.cn/frontend-plugin/page-watermark&quot;&gt;源码&lt;/a&gt;。或者拉下来感受一下。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;npm install yl-page-watermark -S&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;下面我们说一下优化点。&lt;/p&gt;
&lt;p&gt;
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/45e515ca5c09a787a9ac280555d75c1e/6c314/img02.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 544px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 177.75735294117646%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAABcSAAAXEgFnn9JSAAAE1ElEQVRIx51UTW8cNRh2ulRpummiJmkEEvQAUlUO/AiKQFQVFESBC4JfUII4cGsiDhzgABKVKvFxQ0gF1BahlpYiQEKonFCbj002ye5msslust+79ow9tmfGPB4ny8KpZfTKesdjv/M+HzbJPpR5dGxk6lAmM0T+87iJYUKmRw8+Mn7o4bHD02Mj00eGH5saPX5s/OSTU2T43LsTb81NvHnh4Nl3MmfOZ868nTk9k3l+5sBzM+TZGXLq/PDp9yZfmZ06Nzfx0uzEixeOvfz+5Nm5yRdmj7/xAcn+YaZ+N+Rnc+C2ITfN0A0zdN2Qq+bo9+apW+bkj+bxa4Z8aYa+MOQzQy4ZcjGNjw350JCjN/n0DXHkejT+gx69Ema/5dnL4fBX4dTX/MR3/olv6BOX+cjnKnspPHwRIbOfasToJ1H2I0k8Hns8WWmy+Uoz32RlnmyyqBwk6111t0Lna3zBa3k15vmJR+PVBs9VerkqXfOa5bYiSZIYY2o7lfzKcqtZR+5mpOC17c1Wfbe9s22UtFPGdFv16pZXrZR5u26SmIRKhjIMtP5r12/7QikpwhAzUqkojhA8FEEosEzIUMWRTkMlEQsCwgI/TpIoiqQM3T8TG0mMDkyCdSgVJyhjHx1prSN80yrqUUqkVrVGfX5xobhRWius59dWS97GerGwuVXG68LSYrFUZIz14USJrnRLOz0PtQg+dGmv0Wq2u51mu+WSVqeNfKe2W2828FUp1d8MXG3WEBFDD6TT7eDnaMWBcQlGIQSSOO1caQ0KXAR+oBXatwuIzwNASlKEFiTAa3ClQRVGl+t9nlxdu86YUErLNhpbWc3nV/OAilopsDhOObMBOtPXyOAfRkZhlZZqQVkpTXgqA7BtVbYBFX9O9gg3jnAu+P6kBY1CgaKBpsxnVir0hhUogQ4xohwkRVcYqc8CHlgvDASQ+wHHRotZhKKvsHvcf6SS8Z488QDsOBQS7kEVQhmr1WuLuaW19TWIDPCFUnG9ULCar+bta7FIGXUlUMnnrNxeqwdbkIAEgkspoSpo6/S6gA3rdLrdHu31GG00m5gELrNHgdGxFlGAkNjsp5CAti9Mf7RJrB0RwO8iTOkIIXjI7ea0n0Ra7aM+yU4naymND2pQ6jhlCERab0MnoHVOzq0sO4cX4fDC+uLSIugAoj5mqzPbqNINn/kEnXAhABIJ2AdOjFYhwSmltXodrQ10ZEdfUiao9TboAeHKIdxHbk8iavl+OqMGMQec9xiD1LCGPRhRHO8fYPsAEnKsw3zarbVnP2AhlN7ztsO8nF+BsReXlnK5HAR3agM5zjnyf2GOZYUWd33P6uy8DZxADjMAM0A6zEggMhI0n5KfHg+cVlxNsbCbsc3qrBVuBZG2NKgzXllayLlaWPDwNo63BsdWZwC2h1brfyhN9u4wEANsfcD9Y4/t2Ejceby3MA9suMZw9UBtXGDI787fA3JXyDXstYNCy1+otkotituEgAx4Bc2jkmuPpkA6eHpdizb1U9oU2IqBgfEQTQIpwQrrWAfJuTdNXCFroVD0A6T4KA13K+m7e7uXknz/gbq4YVGLQJX7D3sNR/rOn3deff21W7d/euDNEO+X3359+plTV65dfbDNLoB2s7xp77D/sRnh7sa/AcDDeGJth2IPAAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img02&quot; title src=&quot;/static/45e515ca5c09a787a9ac280555d75c1e/6c314/img02.png&quot; srcset=&quot;/static/45e515ca5c09a787a9ac280555d75c1e/cf440/img02.png 148w,
/static/45e515ca5c09a787a9ac280555d75c1e/d2d38/img02.png 295w,
/static/45e515ca5c09a787a9ac280555d75c1e/6c314/img02.png 544w&quot; sizes=&quot;(max-width: 544px) 100vw, 544px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
     —&gt; 
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a0456dd94eb2bcebf405aea6d1534606/34e8a/img03.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 148.83333333333331%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABX9AAAV/QHNcFFhAAADiElEQVRIx6VVTYsdRRTtRVxlkxAVQlaCujMg4m+YPzRLIai4EFGSmQkITlDcTEQw2egI/gOjEZWRF94bkYHJ9Hv9+fq7+3X3yT2Vvk5N540RLTjcrtu3Tp17b1W3c3HvBBf3XLzwpYsLX7i4LPay2Bc/d/HyHRcvfebiyqfiu+3i0rbMBVduCj4R30ey7n1Z967ghuAdF47zHeB8K/hG8BVwbR+4/gPwuvjf+h54W+av3gPeuA+89jXwyh7wptjrd4Grd2TNh4IPBO8Jbgg+nq6w82cr6HH7ENieATtT4NajHlsTeZ70uHXQY1uwcwDc/E3ifge2fpXnhxLzsMPWz4KfOmw/6OBAR5UCWYg+DQyQR+gT31hUS6CI0KUyL2O0iSf+gItwdvRwoiSQd39g7kd4PF/AD2P4UQwvCHGy8Iz1wghzL4Dr+RIX4ETiFn6IrKxQNS2KqkGal8iKCk6WyU7FX8jFEQQB4jjGcrlEFEVmTvDZ932D+XwOz/OMP8syVFWFtm3RdR36XhSWq6diszwzC9M0PQNu4LouwjA0IOlSfPSvG07RdCb38VjJrqvVyuzedh3OG1RlwylqSmyQF4VRlCSJSYdpUTHToo+KqJCWc6JpmmdInSJ9DCx/RJqVJh2ScCFrxbmmuVgsDLiR+khKEiVlHQeFLeq6NgFsiDaFlgpVHclIqhszo24ox6nCBv9qmFoKnlvDMpsD6S+ScoFAdqYKk+KQsh4ff3gXBE/LoKWx69h1QpjmKerMFfmZSS/Pc3O2yrI0lgtYDj4X0jj667oxfqIdToPGO2lZo21KdEbyaXE1hU6t5dM5SShCiU1TyuwESB4gYcqSjt4OTUs7rN3V46SdJuzGOGlRG/ZGZHOn1WC5O9PXMjDYxA0x58HxokQWnV41EqgCHiPOfVF8fHxsfJyPr6cNx48T5ENQZlkbLAHvM8+j+mwBNhw/OiUcQxcyZXZYr6DW2CZfS2jvNCYlAYl4e0hsvxulnKIYiq8Kxumfl97alBfhEnEUnjn963ZfN1cfhXAt4bjy6V8On6TzUn5eGZSMHEPKEvAPJOOaqWU9dc7ryeY902U7WEug/491yvUUHB0dmfqvJVQiW8G4CaqcyiaTCTY2NrC7uys3RZqSDS9t2A0Yv7PB80l1m5ub2N/fhxPLp7+pK/Pp+a/gHf7743DwaIbDwxlms/+H6XRq8ARP8MbabmjdigAAAABJRU5ErkJggg==&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img03&quot; title src=&quot;/static/a0456dd94eb2bcebf405aea6d1534606/b9e4f/img03.png&quot; srcset=&quot;/static/a0456dd94eb2bcebf405aea6d1534606/cf440/img03.png 148w,
/static/a0456dd94eb2bcebf405aea6d1534606/d2d38/img03.png 295w,
/static/a0456dd94eb2bcebf405aea6d1534606/b9e4f/img03.png 590w,
/static/a0456dd94eb2bcebf405aea6d1534606/34e8a/img03.png 600w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;可以看到我们之前那种效果太规律了，太显眼了，所以 po 要求变成右边这种效果。所以我们要改变一下我们的水印生成方式。原先我们是两层循环，在第二层循环里面去创建水印。现在我们可以在第一层循环下面先创建一行的水印。然后判断如果是奇数行，那么就向右移动一点距离。也要注意下，如果水印有倾角，我们整个水印容器的高度也需要重新用余弦或者正弦计算一下，不然在底部会有一部分三角形的空白。&lt;/p&gt;
&lt;p&gt;最后，&lt;code class=&quot;language-text&quot;&gt;pointer-events&lt;/code&gt;的兼容性如下：&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/db46e7230409c4a733d7d6d1e8e4b0f0/2f8d2/img04.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 39.044117647058826%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA/+AAAR/gGkbhtQAAABaElEQVQoz11RWXakMAzk/gfLRsJmjDGmDRholl6THKAiqfPmzcxHvXKpRFky0Xb9xHq5C/bbF7ppwbSdsJxvmPcLisqSPuN4ukrNhxkzae5nP9e1sPiE6P/AA33Q+AHdeHycuwGuD/CkOcySx75pO9QE1tb36OeVesO/gXwOy45xPf2ZKBw3GOfFZ82XaOvoklHq7TAJ8xbM0fYb9vfK3MSBYdlkMm1bWYs/Yq9qWgqeYA+96Lr1oiWQQxjb9Qunz2+4bkSmDJpDoPdrRCvixgd6L0vhHnlZiy6No9BBuGq8vGc00EoD7c9Yz3do5/CUvCGzGq/ZB5KqwHMaQzmDl+wdscrwnMRIjMJbkZD/4FiliNMUUa4NUqVpKg3nR+ihRrXlhBLlMYdeCkIOs5eCalUoSas5ox4lfho+pNcH/5jw8SN2tP2MzBVwN4PDnda81HS2xAYtcUs1ezaody0ea67zRY70tIz4AcFzQvvHlXU2AAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img04&quot; title src=&quot;/static/db46e7230409c4a733d7d6d1e8e4b0f0/b9e4f/img04.png&quot; srcset=&quot;/static/db46e7230409c4a733d7d6d1e8e4b0f0/cf440/img04.png 148w,
/static/db46e7230409c4a733d7d6d1e8e4b0f0/d2d38/img04.png 295w,
/static/db46e7230409c4a733d7d6d1e8e4b0f0/b9e4f/img04.png 590w,
/static/db46e7230409c4a733d7d6d1e8e4b0f0/f9b6a/img04.png 885w,
/static/db46e7230409c4a733d7d6d1e8e4b0f0/2d849/img04.png 1180w,
/static/db46e7230409c4a733d7d6d1e8e4b0f0/2f8d2/img04.png 1360w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;可以看到，移动端基本可以覆盖到当下主流的所有系统版本。pc 端是 ie11 以上。&lt;/p&gt;
&lt;p&gt;页面水印的制作过程其实就这么多。是不是很简单，主要的点就是&lt;code class=&quot;language-text&quot;&gt;pointer-events&lt;/code&gt;这个属性。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;前面我聊的更多的是水印的显示方案。接下来我们衍生一下。来看看当下较为主流的前端水印生成方案：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dom 生成，最简单，也是我们这个页面水印的实现方式。&lt;/li&gt;
&lt;li&gt;Canvas 或者 Svg 实现。用 background-image 平铺背景图。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这就是我们前端最常用的两种水印生成方式，但是，它们会有什么问题呢？比如，如果有人用开发者工具修改了 background-image 这个属性或者删掉了整个 dom 那水印就失效了？&lt;/p&gt;
&lt;p&gt;这里我们可以用&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver&quot;&gt;Mutation Observer API&lt;/a&gt; 。他可以监听&lt;code class=&quot;language-text&quot;&gt;DOM&lt;/code&gt; 的任何变动，比如节点的增减、属性的变动、文本内容的变动，这个 API 都可以得到通知。&lt;/p&gt;
&lt;p&gt;但是 MutationObserver 对于自己本身被删除，是没有办法的,那么我们可以通过监测父结点来达到要求。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt; &lt;span class=&quot;token function&quot;&gt;monitorChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 监听dom变化&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; MutationObserver &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MutationObserver &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WebKitMutationObserver&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MutationObserver&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; mo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MutationObserver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; __wm &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;otdiv&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 只在__wm元素样式变动或者被删除才重新调用 loadmark, styleStr为样式字符串&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__wm &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; __wm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAttribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;style&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;styleStr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;__wm&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// 避免一直触发&lt;/span&gt;
          mo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;disconnect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          mo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;loadMark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// 监听父元素&lt;/span&gt;
      mo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;observe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parentEle&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        attributes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        subtree&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        childList&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样就解决了我们刚刚提到的问题。但是这样就安全了吗，我们还会有其他的攻击手段，比如有损压缩，涂改等。那么，针对这种攻击手段，我们有更安全的解决方案吗？&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;其实最安全的方式就是让用户不知道有水印，即让用户看不到水印，当然就不会有刻意的攻击。接下我们来聊聊盲水印。当然，这已经我们最先的需求：&lt;strong&gt;起到警示作用&lt;/strong&gt; 背道而驰了，这里主要是帮助大家拓展一下视野，以便大家以后遇到类似的需求能够第一时间想到对应的解决方案。&lt;/p&gt;
&lt;p&gt;所谓&lt;strong&gt;盲水印&lt;/strong&gt;，是指人感知不到的水印，包括看不到或听不见（没错，数字盲水印也能够用于音频）。其主要应用于音像作品、数字图书等，目的是，在不破坏原始作品的情况下，实现版权的防护与追踪。&lt;/p&gt;
&lt;p&gt;接下来，我们说一下三种不同的盲水印实现方案：&lt;/p&gt;
&lt;h3&gt;方案一：降低透明度，让水印近似不可见&lt;/h3&gt;
&lt;p&gt;一般我们可以把透明度设置为 0.002。但是再 ps 软件下调高对比度即可清晰看到水印。但是这种本质上来说还不是盲水印，因为只是颜色变淡了，仔细看还是能看到一点点，如下图：&lt;/p&gt;
&lt;p&gt;
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/78f6c028ba7f97e8874d6a9a668e02fa/eea37/img05.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 467px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 102.35546038543897%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABU5AAAOwwEWv1ovAAABV0lEQVQ4y72TwWrCQBRFJ9FMpZBCo01JtNCFmqz9l2KX/bn+hEJ/RRuEQj+gmzjvdsYxySSZWEVo4PAmixzuvEvYV5JASMhGmoKmU9BiAdrtoB4SAkSkz8bUACxnDKILxzlM8n3QZgNqCOsyDSPO0clgANHrgYbD84XC86AgY5ZIqXBdUBBckLAp6RJut9oghfb96ferhGbS4jlfaLmyLWW5wwpeTX4jm3YhgotL4XaU0O3Vhfs/hOi7QJ9VeEfUmTuAI2fgA42EhbMlXI7esRytJOsWrw9rvNyv8Pb8ge/s59iJfX9lKX4M+GM7dxPg9hGIE+AzO3xelNwSqeMh4STaYxLlVp7iHFGYI53lyDI6Cul0y1FEsBHL5GOZMgwJsxlZhdYdnhaSFs6vFCqZml0Ju65bCpXApJ4QmJcJ9Z/XTAgYLZuJzLNdSDWhKbtgh+gs5V9a/gU3Ob7/miKGUwAAAABJRU5ErkJggg==&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img05&quot; title src=&quot;/static/78f6c028ba7f97e8874d6a9a668e02fa/eea37/img05.png&quot; srcset=&quot;/static/78f6c028ba7f97e8874d6a9a668e02fa/cf440/img05.png 148w,
/static/78f6c028ba7f97e8874d6a9a668e02fa/d2d38/img05.png 295w,
/static/78f6c028ba7f97e8874d6a9a668e02fa/eea37/img05.png 467w&quot; sizes=&quot;(max-width: 467px) 100vw, 467px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
     —&gt; 
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1cf3a0572563c2fa9d2843daf3dfbcbf/77c37/img06.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 38.32335329341318%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABU5AAAL1wE+2k+RAAAB40lEQVQoz0WS7WvTUBTGr2P+A/oH7rtf+mGWiVKGoiL4YQhuI9lcGQjDzukXRQXbFVItlSR17dKk6Uva0jeb0tK0SRMIPN5zZXjgwuWenCe/55zD6qkUejs7uDo/hzMYoN1solqtotfrwbIsGIaBfr+PSqWCVqsF27ZRLBah6Tpy2UtcfjvD7omErXspSHuvwQaMAfwY95MIAPiLBUzTBMVwOITjOOJOb1EUIZfLIZFIQNVUSAeHeCvv48vHDN6fHOPzxTuw5eY/Qff5M6x5YeT7mEwmiOMYCy4+nU6FoOu68HluvV6j2+2iXC7jzfERDl8dYD+j4MUHHXtfTTBz4w7m7BbKD3YFoTefCxoSJKs3hGR/NpsJylqtBk3TIB/JyJxd4FP2J7K/qvhe/A12d8PBbTbFy6ddXhYi8COMx2Mh6HmeIKMg6uVyKd4HvNdEKEkSlIKCTrsJ27yGbRnc7KZLjvHwUZ2XrTiFJ2huCskeBQ1jzumDIPhPKMvI5/Oo89w1H55h1LgWWwjBJ4//8LIYYRgLGorVaiVsUlAvwzAU99FoBJ1PmQhJkH5mCEFOmEzq2N5u4/T0B18Lk/fPQqFQQJOvD9kqlUrodDpiVWidGo2GyKuqinQ6DUVRxLfUdzp/AX/0GNA2OgGcAAAAAElFTkSuQmCC&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img06&quot; title src=&quot;/static/1cf3a0572563c2fa9d2843daf3dfbcbf/b9e4f/img06.png&quot; srcset=&quot;/static/1cf3a0572563c2fa9d2843daf3dfbcbf/cf440/img06.png 148w,
/static/1cf3a0572563c2fa9d2843daf3dfbcbf/d2d38/img06.png 295w,
/static/1cf3a0572563c2fa9d2843daf3dfbcbf/b9e4f/img06.png 590w,
/static/1cf3a0572563c2fa9d2843daf3dfbcbf/f9b6a/img06.png 885w,
/static/1cf3a0572563c2fa9d2843daf3dfbcbf/77c37/img06.png 1002w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h3&gt;方案二：canvas+算法&lt;/h3&gt;
&lt;p&gt;我们知道图片的像素信息里存储着 &lt;code class=&quot;language-text&quot;&gt;RGB&lt;/code&gt; 的色值，R、G、B 分别为该像素的红、绿、蓝通道，每个通道的分量值范围在 0~255。这时候，对 R 分量的值+1，比如红色由(255,0,0)变为(254,0,0)，这时候人眼是完全看不出差别的。于此同时，修改 G、B 的分量值，也是我们无法察觉的。因此可以得出重要结论：RGB 分量值的小量变动，是肉眼无法分辨的，不影响对图片的识别。接下来我们说下具体的实现方式。&lt;/p&gt;
&lt;p&gt;首先在页面加入三个 canvas 标签，分别用来放原图，合并水印后的图片以及解析后的水印图片。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;canvas&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;256&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;256&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;canvas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;canvas&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;canvas2&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;256&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;256&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;canvas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;canvas&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;canvas3&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;256&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;256&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;canvas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;合成水印&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// canvas+算法盲水印&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ctx &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;canvas&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2d&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ctx2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;canvas2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2d&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; ctx3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;canvas3&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2d&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 获取图片数据&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; img &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; originalData
img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;src &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/demo/assets/demo02.jpg&apos;&lt;/span&gt;
img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;drawImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 获取指定区域的canvas像素信息&lt;/span&gt;
  originalData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 生成水印&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; textData
  ctx2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;font &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;30px Microsoft Yahei&apos;&lt;/span&gt;
  ctx2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fillText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;明源云链&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;130&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  textData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ctx2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ctx2.putImageData(textData, 0, 0);&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// 合成图片&lt;/span&gt;
  originalData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mergeData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;textData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; originalData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;R&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 画出合成后的图片&lt;/span&gt;
  ctx2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;putImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;originalData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;mergeData&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;newData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; oldData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; oData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; oldData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; bit&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; offset &lt;span class=&quot;token comment&quot;&gt;// bit是取模后的值，offset的作用是找到alpha通道值&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;color&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;R&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      bit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
      offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;G&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      bit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
      offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;B&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      bit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
      offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; oData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; bit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// 只处理目标通道&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; oData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 没有信息的像素，该通道最低位置0，但不要越界&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;oData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          oData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          oData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;newData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; oData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
        oData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; oldData
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;最后我们得到了合成了水印后的图片：（左图为原图，右图为合成后）&lt;/p&gt;
&lt;p&gt;
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/70b56c6d86eb86ecb2c9f3624d15056a/00397/img08.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 256px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAC+UlEQVQ4y42Sy08TURSH7zzLQ4HioggaICZGE6MYRY08qsYqibghWsANW43yB7j036H0ObQg0WB0QRQTwMTEFbpTMREo0Mc8+vPcOy0MTQlO8vWce+b2m3PuDJMYA6vB/9SlGjB+o7GhAW2BABrq6+H3+3GitVX8QdM0qIqCY42NaGluFvsOEx0QNjU1YXJyEreCQYyMjGBiYgLd3d0Ih8Po6uzEvVAIl3t68HB4+GihompiU1//AE53duHsufO4czeE3us38Oz5C1G7cPESrvReQ+j+kCtUVEiyUhNWOY96z9mo5aiX63zt16QDew7FFxwHRxschX77CbTgGFSeU1QGwpAHHou11PdI5PrgGPT+cYHWPwatj9acm6MC5vsAVNDfE+8oJ7QFN/fCa9obyudd1DlAmXWjVobpRg5qirMLPbUDOVkAi5tQExYUD2qSYoyIFqFE8pAjObCpCgVIU6aA+WYtaOki9DSJjCJaZgtomyuCJUtQjBLkFMWUA5VylWoal8dJGidJjCT0EClqgUXKcKEvQzdmijieyePl1yzOvKWnJiEkskFjkbQiVBM2ND4BSaUodURI0ySN2BRtLjTBpYyEr75lcXVhFyxG5yG6g9shSfVUWRh3SGhT5AISThc9QssV1nEhjT20uIunK1n4DFPI9kauFsboCAghjJAwYoruJD6ynqGReZcUWdLEg8Ud9PAuE+WRawo9HXLhtEdYJzo0xTn60lxKZ5SyxMiq4Uo5PkInoZ5woMdtMbZMIplGdqMlYBJJOGyGMCg3HLCULd4yfzEVJB6paxajetRxmaL/8E9FRNulfT4HTsfrPE7NFQQdmQLaiZP0KbWl8xTzbj6TJ3KCAH2/AfpuA0kPiW2wbctGVuDsY3JsbBGbloeqddaysF0FA0o4GodCmb3c3r8v6jynI7FpcTglWBTdre7lzasvvpc59ONSgg03ckVFyq/1P+tY+ryEldUv+LuxgbXva/i49AkbW5v4+es3lpdXqfZDPOwfWKrrCRilWIUAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img08&quot; title src=&quot;/static/70b56c6d86eb86ecb2c9f3624d15056a/00397/img08.png&quot; srcset=&quot;/static/70b56c6d86eb86ecb2c9f3624d15056a/cf440/img08.png 148w,
/static/70b56c6d86eb86ecb2c9f3624d15056a/00397/img08.png 256w&quot; sizes=&quot;(max-width: 256px) 100vw, 256px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
     —&gt; 
  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/70b56c6d86eb86ecb2c9f3624d15056a/00397/img08.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 256px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAC+UlEQVQ4y42Sy08TURSH7zzLQ4HioggaICZGE6MYRY08qsYqibghWsANW43yB7j036H0ObQg0WB0QRQTwMTEFbpTMREo0Mc8+vPcOy0MTQlO8vWce+b2m3PuDJMYA6vB/9SlGjB+o7GhAW2BABrq6+H3+3GitVX8QdM0qIqCY42NaGluFvsOEx0QNjU1YXJyEreCQYyMjGBiYgLd3d0Ih8Po6uzEvVAIl3t68HB4+GihompiU1//AE53duHsufO4czeE3us38Oz5C1G7cPESrvReQ+j+kCtUVEiyUhNWOY96z9mo5aiX63zt16QDew7FFxwHRxschX77CbTgGFSeU1QGwpAHHou11PdI5PrgGPT+cYHWPwatj9acm6MC5vsAVNDfE+8oJ7QFN/fCa9obyudd1DlAmXWjVobpRg5qirMLPbUDOVkAi5tQExYUD2qSYoyIFqFE8pAjObCpCgVIU6aA+WYtaOki9DSJjCJaZgtomyuCJUtQjBLkFMWUA5VylWoal8dJGidJjCT0EClqgUXKcKEvQzdmijieyePl1yzOvKWnJiEkskFjkbQiVBM2ND4BSaUodURI0ySN2BRtLjTBpYyEr75lcXVhFyxG5yG6g9shSfVUWRh3SGhT5AISThc9QssV1nEhjT20uIunK1n4DFPI9kauFsboCAghjJAwYoruJD6ynqGReZcUWdLEg8Ud9PAuE+WRawo9HXLhtEdYJzo0xTn60lxKZ5SyxMiq4Uo5PkInoZ5woMdtMbZMIplGdqMlYBJJOGyGMCg3HLCULd4yfzEVJB6paxajetRxmaL/8E9FRNulfT4HTsfrPE7NFQQdmQLaiZP0KbWl8xTzbj6TJ3KCAH2/AfpuA0kPiW2wbctGVuDsY3JsbBGbloeqddaysF0FA0o4GodCmb3c3r8v6jynI7FpcTglWBTdre7lzasvvpc59ONSgg03ckVFyq/1P+tY+ryEldUv+LuxgbXva/i49AkbW5v4+es3lpdXqfZDPOwfWKrrCRilWIUAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img08&quot; title src=&quot;/static/70b56c6d86eb86ecb2c9f3624d15056a/00397/img08.png&quot; srcset=&quot;/static/70b56c6d86eb86ecb2c9f3624d15056a/cf440/img08.png 148w,
/static/70b56c6d86eb86ecb2c9f3624d15056a/00397/img08.png 256w&quot; sizes=&quot;(max-width: 256px) 100vw, 256px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;怎么解析水印呢？&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; img &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; originalData
img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;src &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/demo/assets/marked.png&apos;&lt;/span&gt;
img&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;onload&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;drawImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;img&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 获取指定区域的canvas像素信息&lt;/span&gt;
  originalData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ctx&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;processData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;originalData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;processData&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;originalData&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; originalData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 红色&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// alpha通道不做处理&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// 关闭其他分量&lt;/span&gt;
      data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 将结果绘制到画布&lt;/span&gt;
  ctx3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;putImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;originalData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;得到的水印：&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1552570c7264be40abaed10a2fc01571/00397/img09.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 256px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAAiUlEQVQ4y2NgYGD4T2U8auCgN5ARiJmR2IxYNDESayAjNV0IM0wWiPOB2BeIQ4E4CogtgNgKiN2AOBGIM4gxkAlKmwHxRSDuA+INQLwbiEuBuAWIS4B4FRDPA2J2YsMQpNAciK2BOBKIg4HYEohtoS71B2InIGYb0GQDi10mKGbEQo/mlFEDqYgBguaZx/eZZFAAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img09&quot; title src=&quot;/static/1552570c7264be40abaed10a2fc01571/00397/img09.png&quot; srcset=&quot;/static/1552570c7264be40abaed10a2fc01571/cf440/img09.png 148w,
/static/1552570c7264be40abaed10a2fc01571/00397/img09.png 256w&quot; sizes=&quot;(max-width: 256px) 100vw, 256px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;hr&gt;
&lt;h3&gt;方案三：真正的盲水印，频域盲水印&lt;/h3&gt;
&lt;p&gt;前面我们讲的都是前端方案，最后我们讲一个后端方案，也是目前最优的方案。&lt;/p&gt;
&lt;p&gt;什么事频域？我们所看到图像就是空域或者说时域（即二维的图像信号），它随着时间的变化而变化。而频域，我们可以理解它是上帝视角下的时域，它是时域的规律。每一个空域都能通过多个频率合成。频域添加水印的方法，是指通过某种变换手段（我们这里通过傅里叶变换）将图像变换到频域（小波域），在频域对图像添加水印，再通过逆变换，将图像转换为空间域。&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fca610d627ae4e818cf04ffa17b54dbb/1a1ab/img10.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 354px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 25.98870056497175%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAvklEQVQY041QywqDQAzc//8iT4JHQRAETyoKCrK+0RUUH1MmrUVKCx0IbLKTZCYKL5znic930zSo6xpRFGEcR/wDNQwDyrKUZFmW97DjOOD7vtQ4eF1X9H0P8ud5Fl7btojjGNM0oes66VGe58FxHARBgDAMkee5qNJaS35XTZ7rurBtG1mWyYKiKMAZlmVh2zYoKmBQJQksEmmayvZ933Fx+E/rl+ILVGyMeVr+dQsuYHOSJKiq6iuHFhl3Fw952H6lpm1umwAAAABJRU5ErkJggg==&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img10&quot; title src=&quot;/static/fca610d627ae4e818cf04ffa17b54dbb/1a1ab/img10.png&quot; srcset=&quot;/static/fca610d627ae4e818cf04ffa17b54dbb/cf440/img10.png 148w,
/static/fca610d627ae4e818cf04ffa17b54dbb/d2d38/img10.png 295w,
/static/fca610d627ae4e818cf04ffa17b54dbb/1a1ab/img10.png 354w&quot; sizes=&quot;(max-width: 354px) 100vw, 354px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;上面就是傅里叶变换公式。f(t)就是时域，当然这是针对信号的，按照我们的理解就是空域。W 就是频率，如果大家相对傅里叶变化有进一步的了解，可以&lt;a href=&quot;https://zhuanlan.zhihu.com/p/19763358&quot;&gt;戳这里&lt;/a&gt;。反正我们只要知道，有方法可以将空域图像转换成频域。&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/67775b5e4e7250f684a86f8e81e50900/974da/img11.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 29.381443298969074%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3aAH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAGBAAAwEBAAAAAAAAAAAAAAAAABFRIQH/2gAIAQEAAT8hyCmC7T//2gAMAwEAAgADAAAAEPPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgMBAQAAAAAAAAAAAAAAAREAITGBkf/aAAgBAQABPxDIKXUwi8QtpeT/2Q==&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img11&quot; title src=&quot;/static/67775b5e4e7250f684a86f8e81e50900/c739e/img11.jpg&quot; srcset=&quot;/static/67775b5e4e7250f684a86f8e81e50900/8ee9c/img11.jpg 148w,
/static/67775b5e4e7250f684a86f8e81e50900/ebbe7/img11.jpg 295w,
/static/67775b5e4e7250f684a86f8e81e50900/c739e/img11.jpg 590w,
/static/67775b5e4e7250f684a86f8e81e50900/5413e/img11.jpg 885w,
/static/67775b5e4e7250f684a86f8e81e50900/974da/img11.jpg 1164w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;上图就是制作水印的过程
这里的编码做两件事，一个是给水印加密，二是将加密后的水印转换成水印图像频域&lt;/p&gt;
&lt;p&gt;这里我们用到了开源库 --- OpenCV 来实现图像傅里叶变换以及最终的水印合成。
它是一个跨平台计算机视觉库，实现了图像处理和计算机视觉方面的很多通用算法。&lt;/p&gt;
&lt;p&gt;官方支持 Python、Ruby、Go、Java 等主流后端语言和一些硬件编程语言。&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/48d69f8d8f4959fccd8450fef464dbc5/73d01/img11.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50.76335877862596%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC1UlEQVQozx2S3U9aBxyGue+y7mL9RusQKq4UtVCc1n5IZ4VKURQ8fB3gHL6OIAVFQBB1sGZZ2hXrusZ2u1iTJf1I1m3Jkl0szmTJ4mpi22VJs2RZ1q3/yNOTXrwXv5v3/eXJo3l3wI7RcgqTrR+jw4nOH8IYDvO+FKEnJdOXSeLN55CzWRKlBfpkCb0/iG5KoO3yFAdHJ9Cec3BkcIS9gw40h6xDDPf14jjZi3XEjimexKoksZfmGS4VOFlIIxfnqMypqVWxKSmMoohBCNLhmUbr8rLf6eWdYTd7hy6h0Y9e5nqtyFeNJQaCQcq37/D77lN2n//Bzzs72EpZIvN5Mqk0qdks/ZkUJ+IS3SG11C9ydFyg84wdw+A5tP3n1cIxL2vNVb5tXVMLozgXF1Fa1ynf3SC/8TkfVHPMLFUo5nJk83ks6TjtAQHtlBetN0Cb041F38lps5m+HjOabrefr7+8x5+/beNSrtApRTmejNGTTWArznCmXmCmWWehXELKzSJebdK6/4D1+w9Zf/QY/aRAUR1ZX5zHHQiiOTDm44RP5LSsYIpIdMkyxkQMkyJhVfkN1fLI9QqFUom4ylK5cY3Hm7/ww+YW32/9SpcvSK1Y4Mebn+IQYmjEjz8hu9biyq11lJtruGpLpFo3KN/ZoLBxC8ucwuxyjdVqjeXGR9iySfTRMIZQiE4hQPvYBGuffcFfO0+IZRbQfLf5E89ebPPPfy/Y2t2mee8b/v73JS//f6XeTzmelsjUazSWl6murmBNJeiORDim6vWeqk772CQfhuL4MvMMTqsf6saDmMJxeqU05lgSQ0BENx2gNyZjSSTQiyFSlTLNlRUWqlXMkShHJ6dpd3s5fMnDgZFx3j7rZM/ARd5So9lvd3No1EOby0fHhIBBZWL0hzEGwm/U6AqKpMsVrjYaVOp1ekJRdB4B3YSfDrfAkYseDl8Y5+B5N/vOungNPfKp2H4ZAYoAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img11&quot; title src=&quot;/static/48d69f8d8f4959fccd8450fef464dbc5/b9e4f/img11.png&quot; srcset=&quot;/static/48d69f8d8f4959fccd8450fef464dbc5/cf440/img11.png 148w,
/static/48d69f8d8f4959fccd8450fef464dbc5/d2d38/img11.png 295w,
/static/48d69f8d8f4959fccd8450fef464dbc5/b9e4f/img11.png 590w,
/static/48d69f8d8f4959fccd8450fef464dbc5/73d01/img11.png 786w&quot; sizes=&quot;(max-width: 590px) 100vw, 590px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;上面就是水印合成过程，拿到合成图片和原图，经过反编码可以得到下面这个水印&lt;/p&gt;

  &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e7d648896b382401fb7d2add239508e2/42fef/img12.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
  
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block;  max-width: 521px; margin-left: auto; margin-right: auto;&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 164.87523992322457%; position: relative; bottom: 0; left: 0; background-image: url(&amp;apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAYAAADZPosTAAAACXBIWXMAABcRAAAXEQHKJvM/AAAAoUlEQVRIx+2NzQ7CIBAGKZTlZdSGWlug9s+L+v4P9LkQL0Z78rokE5bJZlCV0jCKoFWNShmmhtYG3rfoh4Bz1+P+eGK8zpiXlV3EsmyYprm4PGef3wPvq++g4aDG4XiCbzs0jce63XDpA0JM7M5IacQQYvkwxpFJZW55X/HBL6y1ICbfzjkQUaF4cm/oA2tpP/gHEpSgBCUoQQlKUIIS3OMFk3alc6CJDlUAAAAASUVORK5CYII=&amp;apos;); background-size: cover; display: block;&quot;&gt;
      &lt;img class=&quot;gatsby-resp-image-image&quot; style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot; alt=&quot;img12&quot; title src=&quot;/static/e7d648896b382401fb7d2add239508e2/42fef/img12.png&quot; srcset=&quot;/static/e7d648896b382401fb7d2add239508e2/cf440/img12.png 148w,
/static/e7d648896b382401fb7d2add239508e2/d2d38/img12.png 295w,
/static/e7d648896b382401fb7d2add239508e2/42fef/img12.png 521w&quot; sizes=&quot;(max-width: 521px) 100vw, 521px&quot;&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    
&lt;p&gt;水印在左上角，这个看不清楚，我选的水印颜色不合适，^_^!
这就是频域盲水印。它抗攻击性能强劲。&lt;/p&gt;
&lt;p&gt;所谓对水印的攻击，是指破坏水印，包括涂抹，剪切，放缩，旋转，压缩，加噪，滤波等。这些频域盲水印都能够预防。&lt;/p&gt;
&lt;p&gt;想了解更多，可以&lt;a href=&quot;https://www.zhihu.com/question/50735753/answer/122593277&quot;&gt;戳这里&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;总结&lt;/h3&gt;
&lt;p&gt;其实即使是频域水印，也有预防不了的攻击手段，比如通过拍照获取图片。但是这些已经能够抵御大部分攻击了，而且有些水印对防攻击性要求并没有那么高，所以大家完全可以根据自己需求去使用合适的水印方案。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[三分钟建成个人网站，逼格极高（持续集成）]]></title><description><![CDATA[最近，在一次日常舔大佬的途中，发现某位大佬(Dan Abramov)的 Twitter…]]></description><link>http://wuhub.top/how-to-build-a-easy-blog/</link><guid isPermaLink="false">http://wuhub.top/how-to-build-a-easy-blog/</guid><pubDate>Fri, 30 Nov 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最近，在一次日常舔大佬的途中，发现某位大佬(&lt;a href=&quot;https://mobile.twitter.com/dan_abramov&quot;&gt;Dan Abramov&lt;/a&gt;)的 Twitter 有个文章链接，果断点了进去。进去之后，眼前一亮，这是他的&lt;a href=&quot;https://overreacted.io/&quot;&gt;个人网页&lt;/a&gt;，页面极其简洁，操作流畅。作为一名合格的舔狗，肯定要果断抄袭。。。啊不。。。借鉴一下啦&lt;a href=&quot;http://wuhub.top/&quot;&gt;戳这里&lt;/a&gt;。顺便说下，里面文章干货很多，都是大佬创造 React 的心理历程，后续我准备一一翻译过来，嘿嘿。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;原来大佬也是引用的一个开源库&lt;a href=&quot;https://github.com/gatsbyjs/gatsby-starter-blog&quot;&gt;gatsby&lt;/a&gt;。这是一个 React 静态网站构建器。&lt;/p&gt;
&lt;p&gt;使用它，你的网站可以同时享有静态网站和 React 的优点。通过加载插件，可以做到支持多种数据资源，比如 Markdown，WordPress 的文章等。支持自动代码分割，图片优化，预加载，懒加载等等。关键是他没有后端交互，构建个人网站你甚至不需要买服务器和域名，直接部署在 github pages 上即可。&lt;/p&gt;
&lt;p&gt;生成网站只需要两步：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;npm install -g gatsby-cli&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby new my-blazing-fast-site&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;然后在项目根目录下执行&lt;code class=&quot;language-text&quot;&gt;gatsby develop&lt;/code&gt;，访问&lt;a href=&quot;http://localhost:8000&quot;&gt;http://localhost:8000&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;到这里，你的第一个个人网站就运行起来了，是不是很简单？然后你只需在&lt;code class=&quot;language-text&quot;&gt;src/pages/&lt;/code&gt;目录下面添加 Markdown 格式的文章即可。&lt;/p&gt;
&lt;p&gt;接下来我们要做的就是将网站发布到线上，让其他人看到。两种方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;发布到 github pages 。&lt;/li&gt;
&lt;li&gt;发布到自己的服务器上面。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;这一步也很简单。&lt;/p&gt;
&lt;p&gt;第一种方式，项目打包后执行&lt;code class=&quot;language-text&quot;&gt;git subtree push --prefix=dist origin gh-pages&lt;/code&gt;。把项目推到 gh-pages 分支，然后访问&lt;code class=&quot;language-text&quot;&gt;XXX.github.io/项目名/&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;第二种方式，用&lt;code class=&quot;language-text&quot;&gt;scp&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;rsync&lt;/code&gt;工具把项目推到自己的主机，然后配置&lt;code class=&quot;language-text&quot;&gt;nginx&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;server {
  ...
  location / {
              root /home/blog/MyBlog/public; # 项目路径
              index index.html;
  }
  ...
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;然后访问主机 ip 即可。&lt;/p&gt;
&lt;p&gt;接下来我们来实现集成部署，让我们只需通过&lt;code class=&quot;language-text&quot;&gt;git push&lt;/code&gt;这一操作，就能实现网页的更新。&lt;/p&gt;
&lt;p&gt;这里我们要用到&lt;a href=&quot;https://travis-ci.com/getting_started&quot;&gt;travis&lt;/a&gt;，用过 jenkins 的朋友对这个应该也不会陌生。&lt;/p&gt;
&lt;p&gt;第一步，关联自己的 github 项目，&lt;a href=&quot;https://www.travis-ci.org/account/repositories&quot;&gt;戳这里&lt;/a&gt;：&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1b04951da13ab5d9519261f3e6256cc4/a53a2/eg_01.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 82.1608040201005%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qAH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFxAAAwEAAAAAAAAAAAAAAAAAABBBAf/aAAgBAQABPyGumr//2gAMAwEAAgADAAAAEMMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAERITFB/9oACAEBAAE/EOpHSFaFoohYf//Z&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;eg 01&quot;
        title=&quot;&quot;
        src=&quot;/static/1b04951da13ab5d9519261f3e6256cc4/c739e/eg_01.jpg&quot;
        srcset=&quot;/static/1b04951da13ab5d9519261f3e6256cc4/8ee9c/eg_01.jpg 148w,
/static/1b04951da13ab5d9519261f3e6256cc4/ebbe7/eg_01.jpg 295w,
/static/1b04951da13ab5d9519261f3e6256cc4/c739e/eg_01.jpg 590w,
/static/1b04951da13ab5d9519261f3e6256cc4/a53a2/eg_01.jpg 796w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;第二步（部署到自己的主机），我们在项目的根目录下新建一个 travis 配置文件&lt;code class=&quot;language-text&quot;&gt;.travis.yaml&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;language: node_js #运行环境
node_js:
  - 8.9.0
cache:
  directories: #缓存目录，让travis服务器缓存node_modules 增加打包速度
    - node_modules
before_install: #这一步很重要，将本地私钥传到travis服务器。它可以让travis服务器免密ssh到你自己的主机。
  - openssl aes-256-cbc -K $encrypted_2a36be4ef7a3_key -iv $encrypted_2a36be4ef7a3_iv
    -in id_rsa.enc -out ~/.ssh/id_rsa -d
  - chmod 600 ~/.ssh/id_rsa
after_success:
  - ssh root@xxx.xxx.xxx.xxx &amp;#39;/home/blog/build-blog.sh&amp;#39;
branches: #关联github的部署分支
  only:
    - deploy #只有该分支发生变化时，才会触发自动部署
addons:
  ssh_known_hosts: xxx.xxx.xxx.xxx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;before_install&lt;/code&gt;的内容是通过命令行自动添加的，需要经过以下步骤：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先在本地生成 ssh 密钥对：&lt;code class=&quot;language-text&quot;&gt;ssh-keygen -t rsa&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;将公钥复制到自己的远程主机上：&lt;code class=&quot;language-text&quot;&gt;ssh-copy-id -i ~/.ssh/id_rsa.pub root@123.123.123.123&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;将私钥加密传输到 travis，解决 ssh 登录的加密问题。&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;# 安装travis
sudo gem install travis
# 使用github账号登陆travis
travis login --auto
# 切换目录到项目根目录，执行
travis encrypt-file ~/.ssh/id_rsa --add # 这里就生成了 before_install的内容&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;另外，在使用 ssh 登陆的时候会确认主机信息，travis-ci 自动化运行无法进行交互操作，所以在.travis.yml 中添加以下内容跳过确认：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;addons:
  ssh_known_hosts: xxx.xxx.xxx.xxx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;接下来我们就可以通过 ssh 登陆到远程主机之后，做一系列操作，这里我们直接写了个 sh 脚本&lt;code class=&quot;language-text&quot;&gt;/home/blog/build-blog.sh&lt;/code&gt;：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;cd /home/blog/MyBlog
git pull
npm install
npm run build
echo &amp;quot;Build success.&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;以上，我们就完成了持续集成的配置操作。接下了只需将我们的项目 merge 到相应的 github 分支，就可以测试我们了自动部署了。&lt;/p&gt;
&lt;p&gt;最后，如果你没有自己的服务器，那也可以用 travis + ghpages 的方式实现。配置&lt;code class=&quot;language-text&quot;&gt;.travis.yaml&lt;/code&gt;，像这样:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN # Set in travis-ci.org dashboard
  on:
    branch: master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里就不一一赘述了。&lt;/p&gt;
&lt;p&gt;本项目地址：&lt;a href=&quot;https://github.com/wuyafeiJS/MyBlog&quot;&gt;MyBlog&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[为何要写super(props)?]]></title><description><![CDATA[其实这个疑问对于你正常的使用 React 来说并不重要，但如果你想深挖 React 的工作原理，那么你会发现它的有趣之处 第一点 我写的次数比我想到的还多。 当然，新的class fields 提案让我们避免了这段代码： 这种语法在 React 0.1…]]></description><link>http://wuhub.top/why-we-write-super/</link><guid isPermaLink="false">http://wuhub.top/why-we-write-super/</guid><pubDate>Fri, 30 Nov 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;其实这个疑问对于你正常的使用 &lt;em&gt;React&lt;/em&gt; 来说并不重要，但如果你想深挖 &lt;em&gt;React&lt;/em&gt; 的工作原理，那么你会发现它的有趣之处&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;第一点&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;我写&lt;code class=&quot;language-text&quot;&gt;super(props)&lt;/code&gt;的次数比我想到的还多。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight has-highlighted-lines&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Checkbox&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isOn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当然，新的&lt;a href=&quot;https://github.com/tc39/proposal-class-fields&quot;&gt;class fields 提案&lt;/a&gt;让我们避免了这段代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Checkbox&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    isOn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这种语法在 React 0.13 版本得到支持。而且这种写法也更加符合人体工学。&lt;/p&gt;
&lt;p&gt;让我们继续回到这个例子，它用到了 es6 的特性：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight has-highlighted-lines&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Checkbox&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      isOn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;那么问题来了，&lt;strong&gt;我们为啥要调用 super？ 我们可以不用它吗。如果我们调用它，但是不加 props 会发生什么？它还有其他的参数吗？&lt;/strong&gt; 让我们来探索一下。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;在 js 中，&lt;code class=&quot;language-text&quot;&gt;super&lt;/code&gt; 关联到父级 class 的 constructor。（在我们上面的例子中，它指向&lt;code class=&quot;language-text&quot;&gt;React.Component&lt;/code&gt;）&lt;/p&gt;
&lt;p&gt;重点是，我们可以在调用父级&lt;code class=&quot;language-text&quot;&gt;class constructor&lt;/code&gt;后使用 &lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt;。也就是在&lt;code class=&quot;language-text&quot;&gt;super()&lt;/code&gt;之前是不能用&lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt;的：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Checkbox&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Components&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;//🔴 这里还不能使用`this`&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// 这里就可以使用了&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isOn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们有个很好的理由去解释为啥 Javascript 强制 调用父级 constructor 要在使用 this 前执行。我们想想 class 的层级：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PolitePerson&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;greetColleagues&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 🔴 这是不被允许的&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;greetColleagues&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Good morning folks&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;想象一下，如果我们可以在&lt;code class=&quot;language-text&quot;&gt;super&lt;/code&gt;之前调用 this。一段时间后，我们可能需要修改下&lt;code class=&quot;language-text&quot;&gt;greetColleagues&lt;/code&gt;，如在这个函数里面调用&lt;code class=&quot;language-text&quot;&gt;this.name&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;  &lt;span class=&quot;token function&quot;&gt;greetColleagues&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Good morning folks!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;My name is &apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;, nice to meet you!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是我们忘了 &lt;code class=&quot;language-text&quot;&gt;this.greetColleagues()&lt;/code&gt; 是在 super 之前调用了，这时候&lt;code class=&quot;language-text&quot;&gt;this.name&lt;/code&gt;压根不存在。如你所见，这种代码是很蠢的。&lt;/p&gt;
&lt;p&gt;为了避免这个陷阱， &lt;strong&gt;JS 强制在调用&lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt;前先得调用&lt;code class=&quot;language-text&quot;&gt;super&lt;/code&gt;.&lt;/strong&gt; 这个限制同样应用到了 React Components:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ✅ Okay to use `this` now&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isOn&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这段代码给我们留下了另一个疑问： 为什么让 props 作为 super 的参数？&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;你可能会想，让&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;作为&lt;code class=&quot;language-text&quot;&gt;super&lt;/code&gt;的参数之所以需要，是因为这样 基础的&lt;code class=&quot;language-text&quot;&gt;React.Component&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;constructor&lt;/code&gt; 能够初始化 &lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;，像这样：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// React的内部操作， React.Component对象&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;你如果这样想，那么你离真相不远了，这就是&lt;a href=&quot;https://github.com/facebook/react/blob/1d25aa5787d4e19704c049c3cfa985d3b5190e0d/packages/react/src/ReactBaseClasses.js#L22&quot;&gt;React 源码的操作&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;但是有些时候，你调用&lt;code class=&quot;language-text&quot;&gt;super()&lt;/code&gt;但是不传入&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;，你依旧可以在&lt;code class=&quot;language-text&quot;&gt;render&lt;/code&gt;或者其他方法里面使用&lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;那么它是如何工作的呢？ 这就引出了 &lt;strong&gt;当调用&lt;code class=&quot;language-text&quot;&gt;constructor&lt;/code&gt;之后，React 也会在实例上立即分配&lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// React 内部&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; instance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;YourComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;所以，就算你在写&lt;code class=&quot;language-text&quot;&gt;super()&lt;/code&gt;的时候忘了传入 props，React 依旧会在之后设置它们。下面说下这么做的原因。&lt;/p&gt;
&lt;p&gt;React 新增了对 classes 的支持，它不仅仅只是为了支持 es6 的 classes 。我们的目标是支持尽可能多的 class 抽象。我们&lt;a href=&quot;https://reactjs.org/blog/2015/01/27/react-v0.13.0-beta-1.html#other-languages&quot;&gt;并不清楚&lt;/a&gt; ClojureScript, CoffeeScript, ES6, Fable, Scala.js, TypeScript, 和一些其他的语言 它们对组件的定义，哪一种相对来说会比较成功。所以 React 故意忽略了是否必须调用 super()这一问题 - 尽管 es6 是必须调用的。&lt;/p&gt;
&lt;p&gt;那么，这是否意味着你只需写&lt;code class=&quot;language-text&quot;&gt;super()&lt;/code&gt;来代替&lt;code class=&quot;language-text&quot;&gt;super(props)&lt;/code&gt;呢？&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;答案可能是否定的，因为这里仍有疑问&lt;/strong&gt; 当然，React 会在执行 constructor 之后立刻分发 &lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;。 但是&lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;在调用&lt;code class=&quot;language-text&quot;&gt;super&lt;/code&gt; 和 执行完 constructor 之间 仍然是 undefined：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// React 内部&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; props
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 你的代码&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 如果这里忘了加props&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// {}&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// undefined&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果在 constructor 中某个方法调用了&lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;，上面的写法就会给 debug 带来很大的挑战。
&lt;strong&gt;这就是我为啥建议每次都得写&lt;code class=&quot;language-text&quot;&gt;super(props)&lt;/code&gt;的原因，虽然它不是必须的：&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ✅ We passed props&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ✅ {}&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ✅ {}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样就能保证在 constructor 诞生之前就设置了&lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;。&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;长期以来，React 使用者可能会有一点疑惑。&lt;/p&gt;
&lt;p&gt;大家可能注意到，在 classes 中使用 &lt;code class=&quot;language-text&quot;&gt;context api&lt;/code&gt; (不管是旧的 &lt;code class=&quot;language-text&quot;&gt;contextTypes&lt;/code&gt;还是在 React16.6 中新增的新的&lt;code class=&quot;language-text&quot;&gt;contextType&lt;/code&gt; API), &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; 都是作为 constructor 的第二个参数。&lt;/p&gt;
&lt;p&gt;所以为啥我们不提倡像 &lt;code class=&quot;language-text&quot;&gt;super(props, context)&lt;/code&gt; 这种写法呢？ 其实这种写法也没问题，但是&lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt;使用量较少所以这样的陷阱遇到的不多。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;随着 class fields 提案的诞生，这个陷进已经几乎消失。&lt;/strong&gt; 现在我们压根不需要写 constructor, 所有的参数都会被自动添加，所以现在我们直接这样写： &lt;code class=&quot;language-text&quot;&gt;state={}&lt;/code&gt;，然后可以在里面直接调用&lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;this.context&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;最后，随着 Hooks 的诞生， 我们现在甚至都不要&lt;code class=&quot;language-text&quot;&gt;super&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt;。 不过这就是下个话题了。&lt;/p&gt;</content:encoded></item></channel></rss>