{"componentChunkName":"component---src-templates-blog-post-js","path":"/how-to-build-a-easy-blog/","result":{"data":{"site":{"siteMetadata":{"title":"Trace of Front-end","author":"Yafei Wu"}},"markdownRemark":{"id":"26b78ddc-3db4-5055-b4df-a0cde38d4092","excerpt":"最近，在一次日常舔大佬的途中，发现某位大佬(Dan Abramov)的 Twitter…","html":"<p>最近，在一次日常舔大佬的途中，发现某位大佬(<a href=\"https://mobile.twitter.com/dan_abramov\">Dan Abramov</a>)的 Twitter 有个文章链接，果断点了进去。进去之后，眼前一亮，这是他的<a href=\"https://overreacted.io/\">个人网页</a>，页面极其简洁，操作流畅。作为一名合格的舔狗，肯定要果断抄袭。。。啊不。。。借鉴一下啦<a href=\"http://wuhub.top/\">戳这里</a>。顺便说下，里面文章干货很多，都是大佬创造 React 的心理历程，后续我准备一一翻译过来，嘿嘿。</p>\n<hr>\n<p>原来大佬也是引用的一个开源库<a href=\"https://github.com/gatsbyjs/gatsby-starter-blog\">gatsby</a>。这是一个 React 静态网站构建器。</p>\n<p>使用它，你的网站可以同时享有静态网站和 React 的优点。通过加载插件，可以做到支持多种数据资源，比如 Markdown，WordPress 的文章等。支持自动代码分割，图片优化，预加载，懒加载等等。关键是他没有后端交互，构建个人网站你甚至不需要买服务器和域名，直接部署在 github pages 上即可。</p>\n<p>生成网站只需要两步：</p>\n<ol>\n<li><code class=\"language-text\">npm install -g gatsby-cli</code></li>\n<li><code class=\"language-text\">gatsby new my-blazing-fast-site</code></li>\n</ol>\n<p>然后在项目根目录下执行<code class=\"language-text\">gatsby develop</code>，访问<a href=\"http://localhost:8000\">http://localhost:8000</a>。</p>\n<p>到这里，你的第一个个人网站就运行起来了，是不是很简单？然后你只需在<code class=\"language-text\">src/pages/</code>目录下面添加 Markdown 格式的文章即可。</p>\n<p>接下来我们要做的就是将网站发布到线上，让其他人看到。两种方法：</p>\n<ol>\n<li>发布到 github pages 。</li>\n<li>发布到自己的服务器上面。</li>\n</ol>\n<p>这一步也很简单。</p>\n<p>第一种方式，项目打包后执行<code class=\"language-text\">git subtree push --prefix=dist origin gh-pages</code>。把项目推到 gh-pages 分支，然后访问<code class=\"language-text\">XXX.github.io/项目名/</code>。</p>\n<p>第二种方式，用<code class=\"language-text\">scp</code>或者<code class=\"language-text\">rsync</code>工具把项目推到自己的主机，然后配置<code class=\"language-text\">nginx</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">server {\n  ...\n  location / {\n              root /home/blog/MyBlog/public; # 项目路径\n              index index.html;\n  }\n  ...\n}</code></pre></div>\n<p>然后访问主机 ip 即可。</p>\n<p>接下来我们来实现集成部署，让我们只需通过<code class=\"language-text\">git push</code>这一操作，就能实现网页的更新。</p>\n<p>这里我们要用到<a href=\"https://travis-ci.com/getting_started\">travis</a>，用过 jenkins 的朋友对这个应该也不会陌生。</p>\n<p>第一步，关联自己的 github 项目，<a href=\"https://www.travis-ci.org/account/repositories\">戳这里</a>：</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/./static/1b04951da13ab5d9519261f3e6256cc4/a53a2/eg_01.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 82.1608040201005%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3qAH/8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQABBQJf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAFxAAAwEAAAAAAAAAAAAAAAAAABBBAf/aAAgBAQABPyGumr//2gAMAwEAAgADAAAAEMMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAERITFB/9oACAEBAAE/EOpHSFaFoohYf//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"eg 01\"\n        title=\"\"\n        src=\"/./static/1b04951da13ab5d9519261f3e6256cc4/c739e/eg_01.jpg\"\n        srcset=\"/./static/1b04951da13ab5d9519261f3e6256cc4/8ee9c/eg_01.jpg 148w,\n/./static/1b04951da13ab5d9519261f3e6256cc4/ebbe7/eg_01.jpg 295w,\n/./static/1b04951da13ab5d9519261f3e6256cc4/c739e/eg_01.jpg 590w,\n/./static/1b04951da13ab5d9519261f3e6256cc4/a53a2/eg_01.jpg 796w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>第二步（部署到自己的主机），我们在项目的根目录下新建一个 travis 配置文件<code class=\"language-text\">.travis.yaml</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">language: node_js #运行环境\nnode_js:\n  - 8.9.0\ncache:\n  directories: #缓存目录，让travis服务器缓存node_modules 增加打包速度\n    - node_modules\nbefore_install: #这一步很重要，将本地私钥传到travis服务器。它可以让travis服务器免密ssh到你自己的主机。\n  - openssl aes-256-cbc -K $encrypted_2a36be4ef7a3_key -iv $encrypted_2a36be4ef7a3_iv\n    -in id_rsa.enc -out ~/.ssh/id_rsa -d\n  - chmod 600 ~/.ssh/id_rsa\nafter_success:\n  - ssh root@xxx.xxx.xxx.xxx &#39;/home/blog/build-blog.sh&#39;\nbranches: #关联github的部署分支\n  only:\n    - deploy #只有该分支发生变化时，才会触发自动部署\naddons:\n  ssh_known_hosts: xxx.xxx.xxx.xxx</code></pre></div>\n<p><code class=\"language-text\">before_install</code>的内容是通过命令行自动添加的，需要经过以下步骤：</p>\n<ol>\n<li>首先在本地生成 ssh 密钥对：<code class=\"language-text\">ssh-keygen -t rsa</code></li>\n<li>将公钥复制到自己的远程主机上：<code class=\"language-text\">ssh-copy-id -i ~/.ssh/id_rsa.pub root@123.123.123.123</code></li>\n<li>将私钥加密传输到 travis，解决 ssh 登录的加密问题。</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># 安装travis\nsudo gem install travis\n# 使用github账号登陆travis\ntravis login --auto\n# 切换目录到项目根目录，执行\ntravis encrypt-file ~/.ssh/id_rsa --add # 这里就生成了 before_install的内容</code></pre></div>\n<p>另外，在使用 ssh 登陆的时候会确认主机信息，travis-ci 自动化运行无法进行交互操作，所以在.travis.yml 中添加以下内容跳过确认：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">addons:\n  ssh_known_hosts: xxx.xxx.xxx.xxx</code></pre></div>\n<p>接下来我们就可以通过 ssh 登陆到远程主机之后，做一系列操作，这里我们直接写了个 sh 脚本<code class=\"language-text\">/home/blog/build-blog.sh</code>：</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">cd /home/blog/MyBlog\ngit pull\nnpm install\nnpm run build\necho &quot;Build success.&quot;</code></pre></div>\n<p>以上，我们就完成了持续集成的配置操作。接下了只需将我们的项目 merge 到相应的 github 分支，就可以测试我们了自动部署了。</p>\n<p>最后，如果你没有自己的服务器，那也可以用 travis + ghpages 的方式实现。配置<code class=\"language-text\">.travis.yaml</code>，像这样:</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">deploy:\n  provider: pages\n  skip_cleanup: true\n  github_token: $GITHUB_TOKEN # Set in travis-ci.org dashboard\n  on:\n    branch: master</code></pre></div>\n<p>这里就不一一赘述了。</p>\n<p>本项目地址：<a href=\"https://github.com/wuyafeiJS/MyBlog\">MyBlog</a></p>","timeToRead":5,"frontmatter":{"title":"三分钟建成个人网站，逼格极高（持续集成）","date":"November 30, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/how-to-build-a-easy-blog/","previous":{"fields":{"slug":"/why-we-write-super/"},"frontmatter":{"title":"为何要写super(props)?"}},"next":{"fields":{"slug":"/the-development-of-page-watermark/"},"frontmatter":{"title":"页面水印插件开发"}}}}}